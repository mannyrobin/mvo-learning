window.swpmb=window.swpmb||{},jQuery(function(e){"use strict";function t(){new i({input:this,el:e(this).siblings("div.swpmb-media-view")})}var i,s,o,n,l,a=swpmb.views=swpmb.views||{};swpmb.test="spoon",s=a.MediaList=Backbone.View.extend({tagName:"ul",className:"swpmb-media-list",addItemView:function(e){this.itemViews[e.cid]||(this.itemViews[e.cid]=new this.itemView({model:e,collection:this.collection,props:this.props})),this.$el.append(this.itemViews[e.cid].el)},render:function(){this.$el.empty(),this.collection.each(this.addItemView)},initialize:function(e){this.itemViews={},this.props=e.props,this.itemView=e.itemView||o,this.listenTo(this.collection,"add",this.addItemView),this.listenTo(this.collection,"remove",function(e,t){this.itemViews[e.cid]&&(this.itemViews[e.cid].remove(),delete this.itemViews[e.cid])}),this.initSort(),this.render()},initSort:function(){this.$el.sortable({delay:150})}}),i=a.MediaField=Backbone.View.extend({initialize:function(t){var i=this;this.$input=e(t.input),this.values=this.$input.val().split(","),this.props=new Backbone.Model(this.$el.data()),this.props.set("fieldName",this.$input.attr("name")),this.collection=new wp.media.model.Attachments,this.createList(),this.createAddButton(),this.createStatus(),this.render(),this.listenTo(this.collection,"add",function(e,t){var i=this.props.get("maxFiles");i>0&&this.collection.length>i&&this.collection.remove(e)}),_.isEmpty(this.values)||(this.collection.props.set({query:!0,include:this.values,orderby:"post__in",order:"ASC",type:this.props.get("mimeType"),perPage:this.props.get("maxFiles")||-1}),this.collection.more()),this.$input.on("remove",function(){i.props.get("forceDelete")&&_.each(_.clone(i.collection.models),function(e){e.destroy()})})},createList:function(){this.list=new s({collection:this.collection,props:this.props})},createAddButton:function(){this.addButton=new n({collection:this.collection,props:this.props})},createStatus:function(){this.status=new l({collection:this.collection,props:this.props})},render:function(){this.$el.empty().append(this.list.el,this.addButton.el,this.status.el)}}),l=a.MediaStatus=Backbone.View.extend({tagName:"span",className:"swpmb-media-status",template:wp.template("swpmb-media-status"),initialize:function(e){this.props=e.props,this.props.get("maxStatus")||this.$el.hide(),this.listenTo(this.collection,"add remove reset",this.render),this.render()},render:function(){var e={items:this.collection.length,maxFiles:this.props.get("maxFiles")};this.$el.html(this.template(e))}}),n=a.MediaButton=Backbone.View.extend({className:"swpmb-add-media button",tagName:"a",events:{click:function(){this.collection.models;this._frame&&this._frame.dispose(),this._frame=wp.media({className:"media-frame swpmb-media-frame",multiple:!0,title:"Select Media",editing:!0,library:{type:this.props.get("mimeType")}}),this._frame.on("open",socialWarfareAdmin.resizeImageFields),this._frame.on("close",function(){setTimeout(function(){socialWarfareAdmin.resizeImageFields(),setTimeout(function(){socialWarfareAdmin.addImageEditListeners()},300)},100)}),this._frame.on("select",function(){var e=this._frame.state().get("selection");this.collection.add(e.models)},this),this._frame.open()}},render:function(){return this.$el.text(i18nSwpmbMedia.add),this},initialize:function(e){this.props=e.props,this.listenTo(this.collection,"add remove reset",function(){var e=this.props.get("maxFiles");e>0&&this.$el.toggle(this.collection.length<e)}),this.render()}}),o=a.MediaItem=Backbone.View.extend({tagName:"li",className:"swpmb-media-item",template:wp.template("swpmb-media-item"),initialize:function(e){this.props=e.props,this.render(),this.listenTo(this.model,"destroy",function(e){this.collection.remove(this.model)}).listenTo(this.model,"change",function(){this.render()})},events:{"click .swpmb-remove-media":function(e){return this.collection.remove(this.model),this.props.get("forceDelete")&&this.model.destroy(),!1}},render:function(){var e=_.clone(this.model.attributes);return e.fieldName=this.props.get("fieldName"),this.$el.html(this.template(e)),this}}),e(":input.swpmb-file_advanced").each(t),e(".swpmb-input").on("clone",":input.swpmb-file_advanced",t)});