!function(e){"use strict";var t,a={settings:{fieldIDs:JSON.parse(wpforms_surveys.field_ids),fieldQueue:"",fieldData:{},charts:{},exportSelects:{}},init:function(){t=this.settings,Chart.defaults.global.defaultFontSize=14,Chart.plugins.register({beforeDraw:function(e){var t=e.chart.ctx;t.fillStyle="white",t.fillRect(0,0,e.chart.width,e.chart.height)}}),e(document).ready(a.ready),a.buildUIActions()},ready:function(){_.isEmpty(t.fieldIDs)||(t.fieldQueue=t.fieldIDs,_.isEmpty(wpforms_surveys_cache)?a.getFieldData():(t.fieldData=JSON.parse(wpforms_surveys_cache),a.generateReport()))},initExportChoices:function(){e(".survey-chart-export").each(function(){var a=e(this),r=a.data("id");t.exportSelects["export_"+r]=new Choices(a[0],{searchEnabled:!1,shouldSort:!1})})},buildUIActions:function(){e(document).on("click","#wpforms-survey-report .chart-toggle",function(r){r.preventDefault();var i=e(this),n=i.data("type"),o=i.hasClass("current"),s=i.parent(),l=s.data("field-id");o||(s.find(".current").removeClass("current"),i.addClass("current"),t.charts["chart_"+l].destroy(),t.charts["chart_hq_"+l].destroy(),a.generateChart(l,n,t.fieldData["field_"+l].chart.labels,t.fieldData["field_"+l].chart.data),a.generateChart(l,n,t.fieldData["field_"+l].chart.labels,t.fieldData["field_"+l].chart.data,!0))}),e(document).on("change","#wpforms-survey-preview-questions",function(){var r=e(this).val();t.fieldQueue=[],t.fieldData={},t.fieldQueue.push(r),e("#wpforms-survey-report").empty().prepend(wpforms_surveys.loader),a.getFieldData();var i={action:"wpforms_surveys_set_preview_field",nonce:wpforms_admin.nonce,field_id:r,form_id:wpforms_surveys.form_id};e.post(wpforms_admin.ajax_url,i)}),e(document).on("change",".survey-chart-export",function(){var a,r=e(this),i=r.data("id");if("jpg"===r.val())a=e(" #chart-"+i+"-hq")[0].toDataURL("image/jpeg",1),e("#chart-"+i+"-download").attr("href",a),document.getElementById("chart-"+i+"-download").click();else if("pdf"===r.val()){a=e(" #chart-"+i+"-hq")[0].toDataURL("image/jpeg",1);var n={pageSize:"LETTER",content:[{text:t.fieldData["field_"+i].question,fontSize:20,margin:[0,0,0,35]},{image:a,width:530}]};pdfMake.createPdf(n).download("chart-field-"+i+".pdf")}else"print"===r.val()&&window.open(wpforms_surveys.print+"&field_id="+i);"1"!==r.val()&&t.exportSelects["export_"+i].setValueByChoice("1")}),e(document).on("click",".form-details-print-survey-report",function(t){t.preventDefault(),window.open(e(this).attr("href"))}),e(document).on("click","#wpforms-survey-print-close",function(e){e.preventDefault(),window.close()}),e(document).on("click","#wpforms-survey-print",function(e){e.preventDefault(),window.print()}),e(document).on("click","#wpforms-survey-print-preview .question-toggle",function(t){t.preventDefault();var a=e(this),r=a.parent();a.find("i").toggleClass("fa-chevron-down fa-chevron-right"),r.toggleClass("no-print").find(".chart-area, .table-wrap, .stats").toggle()})},getFieldData:function(){var r=_.first(t.fieldQueue),i={action:"wpforms_surveys_field_data",nonce:wpforms_admin.nonce,form_id:wpforms_surveys.form_id,field_id:r,entry_count:wpforms_surveys.entry_count};e.post(wpforms_admin.ajax_url,i,function(e){e.success&&(WPFormsAdmin.debug(e.data),t.fieldData["field_"+e.data.id]=e.data,t.fieldQueue=_.without(t.fieldQueue,r),_.isEmpty(t.fieldQueue)?(a.cacheFieldData(),a.generateReport()):a.getFieldData())})},cacheFieldData:function(){var a={action:"wpforms_surveys_cache_fields",nonce:wpforms_admin.nonce,field_data:JSON.stringify(t.fieldData),form_id:wpforms_surveys.form_id,field_id:wpforms_surveys.field_id,entry_count:wpforms_surveys.entry_count};e.post(wpforms_admin.ajax_url,a)},generateReport:function(){e("#wpforms-survey-loading").remove();var r=wp.template("wpforms-question-results");e("#wpforms-survey-report").append(r(t.fieldData)),e.each(t.fieldData,function(e,t){_.isEmpty(t.chart.data)||(a.generateChart(t.id,t.chart.default,t.chart.labels,t.chart.data),a.generateChart(t.id,t.chart.default,t.chart.labels,t.chart.data,!0))}),e(".wpforms-table-sorting").stupidtable(),a.initExportChoices(),"list"===wpforms_surveys.type&&e("#wpforms-survey-preview .btn-wrap").show()},generateChart:function(e,a,r,i,n){var o=!1,n=n||!1;"bar"===a?o={type:"bar",data:{labels:r,datasets:[{label:"Data",hoverBackgroundColor:"#2b8fd2",backgroundColor:"rgba(215, 215, 215, 0.65)",data:i}]},options:{responsive:!n,maintainAspectRatio:!1,legend:{display:!1},tooltips:{callbacks:{title:function(e,t){return t.labels[e[0].index]},label:function(a){return a.yLabel+"% ("+t.fieldData["field_"+e].chart.totals[a.index]+")"}}},scales:{xAxes:[{gridLines:{display:!1},ticks:{fontSize:n?20:14,callback:function(e){return"string"==typeof e&&e.length>20?e.substring(0,20)+"...":e}}}],yAxes:[{ticks:{min:0,max:100,stepSize:20,fontColor:"#999999",fontSize:n?20:11,callback:function(e){return e+"%"}}}]}}}:"bar-h"===a?o={type:"horizontalBar",data:{labels:r,datasets:[{label:"Data",hoverBackgroundColor:"#2b8fd2",backgroundColor:"rgba(215, 215, 215, 0.65)",data:i}]},options:{responsive:!n,maintainAspectRatio:!1,legend:{display:!1},tooltips:{callbacks:{title:function(e,t){return t.labels[e[0].index]},label:function(a){return a.xLabel+"% ("+t.fieldData["field_"+e].chart.totals[a.index]+")"}}},scales:{xAxes:[{ticks:{min:0,max:100,fontColor:"#999999",fontSize:n?20:11,callback:function(e){return e+"%"}}}],yAxes:[{gridLines:{display:!1},ticks:{fontSize:n?20:14,callback:function(e){return"string"==typeof e&&e.length>20?e.substring(0,20)+"...":e}}}]}}}:"pie"===a?o={type:"pie",data:{labels:r,datasets:[{hoverBackgroundColor:"#2b8fd2",data:i,backgroundColor:randomColor({luminosity:"light",count:i.length})}]},options:{responsive:!n,maintainAspectRatio:!1,legend:{position:"right",labels:{fontSize:n?20:14,padding:15,generateLabels:function(e){var t=e.data;return t.labels.length&&t.datasets.length?t.labels.map(function(a,r){var i=e.getDatasetMeta(0),n=t.datasets[0],o=i.data[r],s=o&&o.custom||{},l=Chart.helpers.valueAtIndexOrDefault,d=e.options.elements.arc,c=s.backgroundColor?s.backgroundColor:l(n.backgroundColor,r,d.backgroundColor),f=s.borderColor?s.borderColor:l(n.borderColor,r,d.borderColor),u=s.borderWidth?s.borderWidth:l(n.borderWidth,r,d.borderWidth);return a.length>20&&(a=a.substring(0,20)+"..."),{text:a,fillStyle:c,strokeStyle:f,lineWidth:u,hidden:isNaN(n.data[r])||i.data[r].hidden,index:r}}):[]}}},tooltips:{callbacks:{label:function(a,r){return r.labels[a.index]+" - "+r.datasets[0].data[a.index]+"% ("+t.fieldData["field_"+e].chart.totals[a.index]+")"}}}}}:"line"===a&&(o={type:"line",data:{labels:r,datasets:[{label:"Data",borderColor:"#2b8fd2",backgroundColor:"rgba(215, 215, 215, 0.65)",fill:!1,data:i}]},options:{responsive:!n,maintainAspectRatio:!1,legend:{display:!1},tooltips:{callbacks:{title:function(e,t){return t.labels[e[0].index]},label:function(a){return a.yLabel+"% ("+t.fieldData["field_"+e].chart.totals[a.index]+")"}}},scales:{xAxes:[{gridLines:{display:!1},ticks:{fontSize:n?20:14,callback:function(e){return"string"==typeof e&&e.length>20?e.substring(0,20)+"...":e}}}],yAxes:[{ticks:{min:0,max:100,stepSize:20,fontColor:"#999999",fontSize:n?20:11,callback:function(e){return e+"%"}}}]}}}),o&&(n?t.charts["chart_hq_"+e]=new Chart("chart-"+e+"-hq",o):t.charts["chart_"+e]=new Chart("chart-"+e,o))}};a.init()}(jQuery);