'use strict';window.tsfem_e_focus_inpost=function(c){const d=tsfem_e_focusInpostL10n,e='#tsfem-e-focus-analysis-notification-area';let f={},g={},h={};const j=ba=>{return(/.*\[[0-9]+\]/.exec(ba)||'')[0]},k=(ba,ca)=>{return ba+'['+ca+']'},l=(ba,ca)=>{return document.getElementById(ba+'['+ca+']')},m=ba=>{return Object.keys(ba).sort((ca,da)=>{return Object.keys(ca)[0]-Object.keys(da)[0]}),ba},n=(ba,ca)=>{if(ba&&ba===Object(ba)){let da=f;ca=!!ca;let ea,fa;for(let ga in ba)for(let ha in ea=ba[ga],da[ga]||(da[ga]={}),ea)if(fa=ea[ha],da[ga][fa]||(da[ga][fa]=[]),ca){let ia=Object.values(da[ga][fa]);if(-1<ia.indexOf(ha))continue;da[ga][fa].push(ha)}else da[ga][fa]=da[ga][fa].filter(ia=>ia!==ha);f=da}},o=ba=>{const ca=f;let da=g,ea={},fa=!1,ga='',ha=[];const ia=ka=>{ea=ca[ka],fa=!1,ga='',ha=[],'undefined'!=typeof ea.dominate&&ea.dominate.forEach(la=>{document.querySelector(la)&&(fa=!0,ga=la)}),fa||'undefined'==typeof ea.append||ea.append.forEach(la=>{document.querySelector(la)&&ha.push(la)}),fa?da[ka]=[ga]:ha.length?da[ka]=ha:ja(ka)},ja=ka=>{delete da[ka]};if(ba)'undefined'==typeof ca[ba]?ja(ba):ia(ba);else{for(var ka in ca)ia(ka)}g=da};let p={};const q=ba=>{let ca=j(ba.id),da='e_focus_pw_'+c(ba).data('assessment-type')+'_'+ca,ea=ba.querySelector('.tsfem-e-focus-assessment-rating');if(tsfem_inpost.isWorkerBusy(da))return da in p&&clearTimeout(p[da]),void(p[da]=setTimeout(()=>q(ba),2e3));delete p[da],tsfem_inpost.occupyWorker(da),tsfem_inpost.setIconClass(ea,'loading');let fa=O(ca).get('inflections'),ga=O(ca).get('synonyms'),ha=c(ba).data('scores'),ia=0,ja=0,ka=0,la=0,ma=0,na,oa=ha.assessment.regex;oa!==Object(oa)&&(oa=[oa]);const qa=()=>{let sa=ha.scoring,ta=0,ua=0;const va=(Da,Ea)=>Ea>Da?Da:Ea,wa=(Da,Ea)=>Math.floor(Ea/Da.per)*Da.score,xa=(Da,Ea)=>Ea*(Da/100),ya=(Da,Ea)=>100*(Ea/Da),za=(Da,Ea)=>Ea/Da.threshold*ha.maxScore;switch(sa.type){case'n':ia&&(ua+=wa(sa.keyword,va(sa.keyword.max,ia))),ja&&(ua+=wa(sa.synonym,va(sa.synonym.max,ja)));break;case'p':ma&&(ka&&(ta+=ya(ma,xa(sa.keyword.weight,ka))),la&&(ta+=ya(ma,xa(sa.synonym.weight,la)))),ua=za(sa,ta);}let Aa=document.querySelector('input[name="'+ba.id+'"]');Aa&&(Aa.value=ua);let Ba=ba.querySelector('.tsfem-e-focus-assessment-description'),Ca=r(ha.phrasing,ua);Ba.innerHTML===Ca?(tsfem_inpost.setIconClass(ea,t(ha.rating,ua)),Ba.style.opacity='1',Ba.style.willChange='auto'):(Ba.style.willChange='contents, opacity',Ba.style.opacity='0',Ba.innerHTML=Ca,tsfem_inpost.setIconClass(ea,t(ha.rating,ua)),tsfem_inpost.fadeIn(Ba),Ba.style.willChange='auto')},ra=()=>{let sa=document.querySelector('input[name="'+ba.id+'"]');sa&&(sa.value=0);let ta=ba.querySelector('.tsfem-e-focus-assessment-description'),ua=d.i18n.parseFailure;ta.innerHTML===ua?(tsfem_inpost.setIconClass(ea,t(-1,-1)),ta.style.opacity='1',ta.style.willChange='auto'):(ta.style.willChange='contents, opacity',ta.style.opacity='0',ta.innerHTML=ua,tsfem_inpost.setIconClass(ea,t(-1,-1)),tsfem_inpost.fadeIn(ta),ta.style.willChange='auto')};c.when(tsfem_inpost.promiseLoop(g[ha.assessment.content],sa=>{let ta=document.querySelector(sa),ua=c.Deferred();return(na='undefined'==typeof ta.value?'':ta.value,na.length||(na=ta.innerHTML),!na.length)?ua.resolve():(setTimeout(async()=>{await(tsfem_inpost.getWorker(da)||tsfem_inpost.spawnWorker(d.scripts.parserWorker,da)),c.when(tsfem_inpost.tellWorker(da,{regex:oa,inflections:fa,synonyms:ga,content:na,assess:{getCharCount:'p'===ha.scoring.type}})).done(va=>{ia=va.inflectionCount,ja=va.synonymCount,ka=va.inflectionCharCount,la=va.synonymCharCount,ma=va.contentCharCount,ua.resolve()}).fail(()=>{ua.reject()})}),ua.promise())},5,3e4)).done(()=>{qa(),tsfem_inpost.freeWorker(da)}).fail(()=>{ra(),tsfem_inpost.despawnWorker(da)})},r=(ba,ca)=>{let da;for(let ea in ba=m(ba),ba)if(isFinite(ea)&&!isNaN(parseFloat(ea)))if(ea<=ca)da=ba[ea];else break;return da?da:ba[Object.keys(ba)[0]]||''},t=(ba,ca)=>{let da=r(ba,ca).toString(),ea={0:'unknown',1:'bad',2:'warning',3:'okay',4:'good','-1':'error'};return'undefined'!=typeof ea[da]&&ea[da]||ea['-1']},u=ba=>{let ca=l(ba,'keyword').value,da=l(ba,'lexical_form');if(!(!da instanceof HTMLInputElement)){G(ba).to('loading');const ea=ga=>{let ha=l(ba,'lexical_selector'),ia=l(ba,'lexical_data'),ja=Object.values(JSON.parse(d.defaultLexicalForm));ga.length&&(ga.forEach(la=>{la.inflection&&la.category&&ja.push({value:la.inflection,category:la.category,name:la.category+': '+la.inflection})}),A(ba).to('enabled'));let ka=ja.length&&JSON.stringify(ja)||d.defaultLexicalForm;da.value='',ia instanceof HTMLInputElement&&(ia.value=ka),ha instanceof HTMLSelectElement&&(w(ba,ka),ha.disabled=!1,ha.selectedIndex=0)};c.when(((ga,ha)=>{let ia={method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_e_focus_get_lexicalforms',nonce:d.nonce,post_ID:tsfem_inpost.postID,args:{keyword:ha,language:'en'}},timeout:15000,async:!0},ja=c.Deferred();return tsfem_inpost.doAjax(ja,ia,{noticeArea:e,premium:!0}),ja.promise()})(ba,ca)).done(ga=>{ea(ga.forms)}).fail(()=>{v(ba,'lexical')}).always(()=>{G(ba).to('edit')})}},v=(ba,ca)=>{const da=()=>{let ia=l(ba,'lexical_form'),ja=l(ba,'lexical_selector'),ka=l(ba,'lexical_data');ia instanceof HTMLInputElement&&(ia.value=''),ka instanceof HTMLInputElement&&(ka.value=d.defaultLexicalForm),ja instanceof HTMLSelectElement&&(ja.disabled=!0,ja.selectedIndex=0,ja.dataset.prev=0,w(ba,d.defaultLexicalForm)),G(ba).to('unchecked')},ea=()=>{let ia=l(ba,'definition_dropdown'),ja=l(ba,'definition_selection');ia instanceof HTMLSelectElement&&(ia.selectedIndex=0,ia.innerHTML='',document.querySelector('[data-for="'+ia.id+'"]').innerHTML=''),ja instanceof HTMLInputElement&&(ja.value=''),O(ba).clearCache()},fa=()=>{let ia=l(ba,'inflections'),ja=ia&&ia.querySelector('.tsfem-e-focus-subject-selection'),ka=l(ba,'inflection_data'),la=l(ba,'active_inflections');ja instanceof Element&&(ja.innerHTML=''),ka instanceof HTMLInputElement&&(ka.value=''),la instanceof HTMLInputElement&&(la.value=''),O(ba).clearCache('inflections')},ga=()=>{let ia=l(ba,'synonyms'),ja=ia&&ia.querySelector('.tsfem-e-focus-subject-selection'),ka=l(ba,'synonym_data'),la=l(ba,'active_synonyms');ja instanceof Element&&(ja.innerHTML=''),ka instanceof HTMLInputElement&&(ka.value=''),la instanceof HTMLInputElement&&(la.value=''),O(ba).clearCache('synonyms'),tsfem_inpost.isPremium&&M(ba)},ha=()=>{l(ba,'scores').querySelectorAll('input').forEach(ia=>ia.value=0)};switch(ca){case'lexical':da(),ea();break;case'definition':ea();break;case'inflections':fa();break;case'synonyms':ga();break;case'ratings':ha();break;default:da(),ea(),fa(),ga(),ha();}},w=(ba,ca)=>{let da=l(ba,'lexical_selector');for(let ga=da.options.length;ga--;)da.remove(ga);let ea=document.createElement('option'),fa=JSON.parse(ca);if(fa)for(let ga in fa)ea=ea.cloneNode(),ea.value=tsfem_inpost.escapeStr(ga),ea.innerHTML=tsfem_inpost.escapeStr(fa[ga].name),da.appendChild(ea)};let x={};const y=ba=>{let ca=ba.data.idPrefix,da=l(ca,'lexical_selector'),ea=l(ca,'lexical_form'),fa=l(ca,'lexical_data');const ga=()=>{let la=JSON.parse(fa.value),ma=la[ea.value],na={method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_e_focus_get_synonyms',nonce:d.nonce,post_ID:tsfem_inpost.postID,args:{form:ma,language:'en'}},timeout:15000,async:!0},oa=c.Deferred();return tsfem_inpost.doAjax(oa,na,{noticeArea:e,premium:!0}),oa.promise()},ha=la=>{ea.value=la,da.value=la,da.selectedIndex=+la},ia=()=>{v(ca,'inflections');let la=l(ca,'keyword').value.toLowerCase(),ma=ea.value,na=fa.value,oa='',pa=[];return oa=JSON.parse(na)[ma].value.toLowerCase(),pa.push(la),la!==oa&&pa.push(oa),l(ca,'inflection_data').value=JSON.stringify([{inflections:pa}]),c.Deferred().resolve()},ja=()=>{let la=c.Deferred();return c.when(ga()).done(ma=>{v(ca,'definition'),v(ca,'synonyms'),da.dataset.prev=da.value,l(ca,'synonym_data').value=JSON.stringify(ma.synonyms),la.resolve()}).fail(ma=>{1100202===ma||1100205===ma?(v(ca,'definition'),v(ca,'synonyms'),da.dataset.prev=da.value,l(ca,'synonym_data').value='',la.resolve()):(ha(da.dataset.prev||0),la.reject())}),la.promise()};(()=>{G(ca).to('loading'),clearTimeout(x[ca]),x[ca]=setTimeout(()=>{da.dataset.prev==da.value?G(ca).to('edit'):(ha(da.value),+da.value?c.when(ia(),ja()).done(()=>{z(ca),M(ca),G(ca).to('enabled, edit, checked')}).fail(()=>{G(ca).to('edit')}):(da.dataset.prev=da.value,G(ca).to('unchecked, disabled, edit'),v(ca,'definition'),v(ca,'inflections'),v(ca,'synonyms')))},1500)})()},z=ba=>{let ca=l(ba,'synonym_data'),da=l(ba,'definition_dropdown'),ea=l(ba,'definition_selection'),fa=da.cloneNode(!0),ga=ca.value&&JSON.parse(ca.value)||{};for(let ja=fa.options.length;ja--;)fa.remove(ja);let ha=document.createElement('option');for(let ja=0;ja<ga.length;ja++)ha=ha.cloneNode(),ha.value=ja,ha.innerHTML=tsfem_inpost.escapeStr(ga[ja].example||d.i18n.noExampleAvailable),fa.appendChild(ha);da.innerHTML=fa.innerHTML,da.value=ea.value,da.selectedIndex=+ea.value;let ia=l(ba,'definition_selector');da.options.length?(c(document.querySelector('[data-for="'+da.id+'"]')).trigger('set-tsfem-e-focus-definition'),ia.style.display=null):ia.style.display='none'},A=ba=>{const ca=ea=>{c(ea).off('change.tsfemInpostLexical').on('change.tsfemInpostLexical',{idPrefix:ba},y)},da=ea=>{c(ea).off('change.tsfemInpostLexical')};return{to:ea=>{let fa=l(ba,'lexical_selector');if(!(!fa instanceof HTMLSelectElement))switch(ea){case'enabled':ca(fa);break;default:case'disabled':da(fa);}}}},B=ba=>{let ca=l(ba,'scores'),da=ca&&ca.querySelectorAll('.tsfem-e-focus-assessment-wrap');if(D(ba).to('disabled'),!da||da!==Object(da))F(ba).to('error');else{F(ba).to('enabled');for(let ea=da.length;ea--;)E(da[ea]);V(ba),D(ba).to('enabled')}};let C={};const D=ba=>{return{to:ca=>{switch(ca){case'disabled':ba in C&&(clearInterval(C[ba]),delete C[ba]);break;case'enabled':D(ba).to('disabled'),4999<d.settings.analysisInterval&&(C[ba]=setInterval(()=>V(ba),d.settings.analysisInterval));break;default:}}}},E=ba=>{let ca=j(ba.id),da=l(ca,'keyword').value;if(da){let ea,fa,ga,ha,ia;fa=ba.querySelector('.tsfem-e-focus-assessment-rating'),tsfem_inpost.setIconClass(fa,'loading'),ga=!0,ia='undefined'!=typeof ba.dataset.assess&&!+ba.dataset.assess,ea=c(ba).data('scores'),ea&&ea.hasOwnProperty('assessment')&&'undefined'!=typeof g[ea.assessment.content]&&(ba.dataset.assess=1,Q(ba,ea.assessment.content),ga=!1),ga?(tsfem_inpost.setIconClass(fa,'unknown'),ba.dataset.assess=0,ha=document.getElementsByName(ba.id),ha&&ha[0]&&(ha[0].value=0),tsfem_inpost.fadeOut(ba,250)):ia&&tsfem_inpost.fadeIn(ba,250)}},F=ba=>{let ca=c(l(ba,'content')),da=['.tsfem-e-focus-scores-wrap','.tsfem-e-focus-no-keyword-wrap','.tsfem-e-focus-something-wrong-wrap'];const ea=fa=>{da.splice(da.indexOf(fa),1),ca.find(da.join(', ')).fadeOut(150,()=>{setTimeout(()=>{ca.find(fa).fadeIn(250)},150)})};return{to:fa=>{let ga;switch(fa){case'disabled':ga='.tsfem-e-focus-no-keyword-wrap';break;case'enabled':ga='.tsfem-e-focus-scores-wrap';break;default:case'error':ga='.tsfem-e-focus-something-wrong-wrap';}ea(ga)}}},G=ba=>{return{to:ca=>{let da=l(ba,'subject_edit');if(da&&!(!da instanceof HTMLInputElement)){let ea=document.querySelector('label[for="'+da.id+'"]'),fa=da.parentNode,ga='tsfem-e-focus-edit-subject-button-wrap-disabled';ca.split(',').forEach(ha=>{switch(ha.trim()){case'checked':da.checked||(da.checked=!0,c(da).trigger('change'));break;case'unchecked':da.checked&&(da.checked=!1,c(da).trigger('change'));break;case'loading':ea&&tsfem_inpost.setIconClass(ea,'loading');break;case'edit':ea&&tsfem_inpost.setIconClass(ea,'edit');break;case'enabled':da.disabled=!1,fa.classList.toggle(ga,!1);break;case'disabled':da.disabled=!0,fa.classList.toggle(ga,!0);break;default:}})}}}},H=()=>{c('.tsfem-e-focus-collapse-header').off('dblclick.tsfem-e-focus').on('dblclick.tsfem-e-focus',ca=>{if(!tsfem_inpost.isActionableElement(ca.target)){let da=c(ca.target).closest('.tsfem-e-focus-collapse-wrap'),ea=j(da.attr('id')),fa=l(ea,'collapser');fa instanceof HTMLInputElement&&(fa.checked=!fa.checked)}})},I=()=>{let ba={},ca=1500,da=3,fa={},ga={},ha=ca/(100*da);ha*=1.175;const ia=(ma,na)=>{na.style.width=++fa[ma]/da+'%'},ja=(ma,na)=>{fa[ma]=0,na.style.width='0%'};let ka=c('.tsfem-e-focus-keyword-entry');const la=ma=>{let na=ma.target,oa=na.value.trim().replace(/[\s\t\r\n]+/g,' ')||'',pa=na.dataset.prev||'';if(ma.target.value=oa,oa!==pa){let qa=j(ma.target.id);return na.dataset.prev=oa,v(qa),G(qa).to('disabled, edit'),D(qa).to('disabled'),c(l(qa,'scores')).find('.tsfem-e-focus-assessment-description').css('opacity','0'),oa.length?void(tsfem_inpost.isPremium&&d.languageSupported&&u(qa),B(qa)):(F(qa).to('disabled'),void A(qa).to('disabled'))}};ka.off('input.tsfem-e-focus').on('input.tsfem-e-focus',ma=>{let na=j(ma.target.id),oa=l(na,'content').querySelector('.tsfem-e-focus-content-loader-bar'),pa=l(na,'collapser');pa.checked&&(pa.checked=!1,c(pa).trigger('change')),clearInterval(ga[na]),clearTimeout(ba[na]),ja(na,oa),ga[na]=setInterval(()=>ia(na,oa),ha),ba[na]=setTimeout(()=>{clearInterval(ga[na]),la(ma),ja(na,oa)},ca)}),ka.each((ma,na)=>{if(!na.value.length){let oa=j(na.id);v(oa)}})},J=()=>{const ba=ia=>{let ka,la,ma,na,ja=ia.target,oa=0,pa='',qa=0,ra='',sa=ia.data&&ia.data.change||!1;if('undefined'!=typeof ja.dataset.for&&(ka=ja.dataset.for),!ka)return!1;if(la=document.getElementById(ka),na=j(ka),ma=l(na,'definition_selection'),!la)return!1;oa=la.value,pa=ja.innerHTML;const ta=()=>{ja.innerHTML=ra,la.value=qa,ma.value=qa,+qa!=+oa&&(l(na,'active_synonyms').value='',l(na,'active_inflections').value='',M(na)),Aa()},wa=()=>{c(la).blur().hide(),c(ja).fadeIn(300)},xa=Ea=>{ya(Ea.target),+qa==+oa&&Aa()||ta()},ya=Ea=>{qa=Ea.value,ra=Ea.options[Ea.selectedIndex].text},za=Ea=>{let Fa=c(Ea.target).closest(la);1>Fa.length&&Aa()},Aa=()=>{return Da(),wa(),!0},Ba=()=>{ya(la),ta()},Da=()=>{la.removeEventListener('blur',Aa),la.removeEventListener('change',xa),window.removeEventListener('click',za)};(()=>{c(ja).hide(),c(la).slideDown(200).focus()})(),setTimeout(()=>{la.addEventListener('blur',Aa),la.addEventListener('change',xa),window.addEventListener('click',za),sa&&Ba()},10)};let ea='click.tsfem-e-focus-definition-editor',fa='keypress.tsfem-e-focus-definition-editor',ga='set-tsfem-e-focus-definition';c('.tsfem-e-focus-definition-editor').off(ea).on(ea,ba).off(fa).on(fa,ia=>{32==ia.which&&(ia.preventDefault(),ba(ia))}).off(ga).on(ga,{change:1},ba);let ha='change.tsfem-e-focus-edit-subject-toggle';c('.tsfem-e-focus-edit-subject-checkbox').off(ha).on(ha,ia=>{let ja=j(ia.target.id),ka=l(ja,'edit'),la=l(ja,'evaluate'),ma=l(ja,'collapser');ma.checked?(ia.target.checked=!0,la.style.display='none',la.style.opacity=0,ka.style.display=null,ka.style.opacity=1,ma.checked=!1):ia.target.checked?tsfem_inpost.fadeOut(la,150,{cb:()=>{tsfem_inpost.fadeIn(ka,250),ia.target.checked=!0},promise:!1}):tsfem_inpost.fadeOut(ka,150,{cb:()=>{tsfem_inpost.fadeIn(la,250),ia.target.checked=!1},promise:!1})})};let K={};const L=()=>{const ba=ia=>(/\[([0-9]+)\]$/.exec(ia)||'')[1],ca=ia=>{let ja=l(ia,'inflections'),ka=ja.querySelectorAll('input:checked'),la=[];ka.forEach(ma=>{la.push(ba(ma.id))}),l(ia,'active_inflections').value=la.join(),O(ia).clearCache('inflections'),V(ia)},da=ia=>{let ja=l(ia,'synonyms'),ka=ja.querySelectorAll('input:checked'),la=[];ka.forEach(ma=>{la.push(ba(ma.id))}),l(ia,'active_synonyms').value=la.join(),O(ia).clearCache('synonyms'),V(ia)},ea=ia=>{let ja=ia.data.idPrefix,ka=ia.data.type,la=ja+ka;clearTimeout(K[la]),K[la]=setTimeout(()=>{'inflections'===ka?ca(ja):'synonyms'===ka?da(ja):void 0},1500)},fa=(ia,ja)=>{c(l(ia,ja)).find('input').off('change.tsfem-e-focus').on('change.tsfem-e-focus',{idPrefix:ia,type:ja},ea)};let ha='tsfem-e-focus-updated-subject.tsfem-e-focus';c(window).off(ha).on(ha,(ia,ja)=>{if(ja&&ja.idPrefix){const ka=ja.idPrefix,la=l(ka,'inflection_data'),ma=l(ka,'synonym_data'),na=l(ka,'definition_selection'),oa=l(ka,'inflections'),pa=l(ka,'synonyms'),qa=oa.querySelector('.tsfem-e-focus-subject-selection'),ra=pa.querySelector('.tsfem-e-focus-subject-selection'),sa=wp.template('tsfem-e-focus-subject-item');let ta=la.value&&JSON.parse(la.value),ua=ta&&ta[0].inflections||{},va=ma.value&&JSON.parse(ma.value),wa=va&&va[+na.value]&&va[+na.value].synonyms||{};qa.style.opacity=0,ra.style.opacity=0;let xa=l(ka,'active_inflections').value.split(','),ya=l(ka,'active_synonyms').value.split(','),za='',Aa=k(ka,'inflection');for(let Ba in ua)za+=sa({id:k(Aa,Ba),value:ua[Ba],checked:!+Ba||-1<xa.indexOf(Ba+'')?'checked':'',disabled:+Ba?'':'disabled'});for(let Ba in qa.innerHTML=za,za='',Aa=k(ka,'synonym'),wa)za+=sa({id:k(Aa,Ba),value:wa[Ba],checked:-1<ya.indexOf(Ba+'')?'checked':''});ra.innerHTML=za,ua.length?(oa.style.display=null,tsfem_inpost.fadeIn(qa)):oa.style.display='none',wa.length?(pa.style.display=null,tsfem_inpost.fadeIn(ra)):pa.style.display='none',ca(ka),da(ka),fa(ka,'inflections'),fa(ka,'synonyms')}})},M=ba=>{c(window).trigger('tsfem-e-focus-updated-subject',[{idPrefix:ba}])};let N={};const O=ba=>{O.hasOwnProperty(ba)||(N[ba]={},N[ba].inflections=null,N[ba].synonyms=null);const ca=()=>{let ga,ha,ia=l(ba,'active_inflections');if(ia instanceof HTMLInputElement&&ia.value){let ja=l(ba,'inflection_data').value;ha=JSON.parse(ja)[0].inflections,ga=[],ia.value.split(',').forEach(ka=>{ga.push(ha[+ka])})}if(!ga){let ja=l(ba,'keyword').value;ga=ja&&[ja]||!1}return ga=ga||!1,N[ba].inflections=ga,ga},da=()=>{let ga,ha,ia=l(ba,'active_synonyms'),ja=l(ba,'definition_selection');if(ia instanceof HTMLInputElement&&ia.value){let ka=l(ba,'synonym_data').value;ha=JSON.parse(ka)[+ja.value].synonyms,ga=[],ia.value.split(',').forEach(la=>{ga.push(ha[+la])})}return ga=ga||!1,N[ba].synonyms=ga,ga},ea=ga=>{if(null!==N[ba][ga])return N[ba][ga];return'inflections'===ga?ca():'synonyms'===ga?da():{inflections:ca(),synonyms:da()}},fa=ga=>{ga?delete N[ba][ga]:delete N[ba]};return{get:ga=>ea(ga),clearCache:ga=>fa(ga)}},P=(ba,ca)=>{if('undefined'!=typeof h[ba]){ca=ca||'unknown';for(let da=h[ba].length;da--;)tsfem_inpost.setIconClass(document.getElementById(h[ba][da]).querySelector('.tsfem-e-focus-assessment-rating'),ca)}},Q=(ba,ca)=>{let da=h;da&&da===Object(da)||(da=[]),da[ca]&&da[ca]===Object(da[ca])||(da[ca]=[]),ba.id&&('undefined'==typeof g[ca]?delete da[ca][ba.id]:0>da[ca].indexOf(ba.id)&&da[ca].push(ba.id)),h=da};let R={},S={};const T=ba=>{const ca=fa=>{tsfem_inpost.promiseLoop(h[fa],ga=>{let ha=j(ga),ia=l(ha,'keyword'),ja=ia.value||'';if(ja.length){let ka=document.getElementById(ga),la=ka.querySelector('.tsfem-e-focus-assessment-rating');tsfem_inpost.setIconClass(la,'loading'),setTimeout(()=>q(ka),150)}})},da=fa=>{'undefined'==typeof h[fa.data.type]||(clearTimeout(R[fa.data.type]),!S[fa.data.type]&&(setTimeout(()=>tsfem_inpost.setIconClass(document.querySelectorAll('[data-assessment-type="'+fa.data.type+'"] .tsfem-e-focus-assessment-rating'),'unknown'),0),S[fa.data.type]=!0),R[fa.data.type]=setTimeout(()=>{ca(fa.data.type),S[fa.data.type]=!1},1500))},ea=fa=>{let ga=W(fa).get('names');c(g[fa].join(', ')).off(ga).on(ga,{type:fa},da)};if(ba)'undefined'!=typeof g[ba]&&ea(ba);else for(let fa in g)'undefined'!=typeof g[fa]&&ea(fa)};let U={};const V=ba=>{ba=ba||0,clearTimeout(U[ba]),U[ba]=setTimeout(()=>{if(ba){let ca=l(ba,'scores'),da=ca&&ca.querySelectorAll('.tsfem-e-focus-assessment-wrap[data-assess="1"]');da instanceof NodeList&&da.length?tsfem_inpost.promiseLoop(da,ea=>q(ea),150):F(ba).to('error')}else{for(var ca in g)c(g[ca].join(', ')).trigger(W(ca).get('trigger'))}},1e3)},W=ba=>{const ca=['tsfem-e-focus.analysis-'+ba,'input.tsfem-e-focus-'+ba,'change.tsfem-e-focus-'+ba];return{get:da=>{return'names'===da?ca.join(' '):'trigger'===da?ca[0]:ca}}},X=()=>{let ba=c(document),ca=document.getElementById('tsf-gutenberg-data-holder');if(ca){const da=la=>`tsfem-focus-gbc-${la}`,ea=la=>document.getElementById(da(la)),fa=(la,ma)=>{ga(la),setTimeout(()=>{o(ma),T(ma)}),ba.trigger(`tsfem-focus-gutenberg-${la}-store-set`)},ga=la=>{if(!ea(la)){let ma=document.createElement('div');ma.id=da(la),ma.style.display='none',ca.appendChild(ma)}},ia=(la,ma)=>{ea(la).innerHTML=ma},ja=(la,ma)=>{c('#'+da(la)).trigger(W(ma).get('trigger'))};ba.on('tsf-updated-gutenberg-title',(la,ma)=>{ia('title',ma),ja('title','pageTitle')}),fa('title','pageTitle'),ba.on('tsf-updated-gutenberg-link',(la,ma)=>{ia('link',ma),ja('link','pageUrl')}),fa('link','pageUrl');const ka=la=>{ia('content',la),ja('content','pageContent')};ba.on('tsf-updated-gutenberg-content',(la,ma)=>{let na=lodash.debounce(ka,500);wp.data.select('core/editor').isTyping()?(P('pageContent','unknown'),na(ma)):(na.cancel(),ka(ma))}),fa('content','pageContent')}},Y=()=>{const ba=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;(()=>{if('undefined'!=typeof d.focusElements.pageUrl){let ca=document.getElementById('edit-slug-box');if(ca&&!(!ca instanceof HTMLElement)){const da=()=>{let ea=document.querySelectorAll('.tsfem-e-focus-assessment-wrap[data-assessment-type="url"][data-assess="0"]');ea instanceof NodeList&&ea.length&&(o('pageUrl'),T('pageUrl'),ea.forEach(fa=>E(fa)))};new ba(()=>{da(),T('pageUrl'),c('#sample-permalink').trigger(W('pageUrl').get('trigger'))}).observe(ca,{childList:!0,subtree:!0})}}})(),(()=>{if('undefined'!=typeof tinyMCE&&'function'==typeof tinyMCE.on){let ca=!1;tinyMCE.on('addEditor',da=>{if(!ca&&'content'===da.editor.id){ca=!0,o('pageContent'),T('pageContent');let ea={},fa=tinyMCE.get('content'),ga=!1,ha=!1;fa.on('Dirty',()=>{ha||(P('pageContent','unknown'),ha=!0)}),fa.on('GetContent',()=>{clearTimeout(ea.GetContent),!ga&&fa.isDirty()&&(P('pageContent','loading'),ga=!0,ha=!1),ea.GetContent=setTimeout(()=>{fa.isDirty()||c('#content').trigger(W('pageContent').get('trigger')),ga=!1,ha=!1},1e3)})}})}})()},Z=()=>{d.isGutenbergPage?X():Y()},_=()=>{let ba=document.querySelectorAll('.tsfem-e-focus-collapse-wrap');for(let ca=ba.length;ca--;){let da=j(ba[ca].id),ea=l(da,'keyword');if(ea.value.length){if(ea.dataset.prev=ea.value,tsfem_inpost.isPremium){let fa=l(da,'lexical_selector');fa.dataset.prev=fa.value,1<fa.length?A(da).to('enabled'):v(da,'lexical'),+fa.value&&(G(da).to('enabled'),z(da),M(da))}B(da)}}},aa=()=>{if(Z(),d.hasOwnProperty('focusElements')&&(n(d.focusElements,!0),o(),T()),0===Object.keys(g).length){let ca=document.getElementById('tsfem-e-focus-analysis-wrap');if(ca instanceof Element){let da=ca.querySelector('.tsf-flex-setting-input');da instanceof Element&&(da.innerHTML=wp.template('tsfem-e-focus-nofocus')())}return}H(),I(),tsfem_inpost.isPremium&&(J(),L()),_()};return c.extend({load:function(){c('.tsfem-e-focus-enable-if-js').removeProp('disabled'),c('.tsfem-e-focus-disable-if-js').prop('disabled','disabled'),c('.tsfem-e-focus-requires-javascript').removeClass('tsfem-e-focus-requires-javascript'),c(document.body).ready(aa)}},{focusRegistry:f,activeFocusAreas:g,activeAssessments:h,updateFocusRegistry:n,updateActiveFocusAreas:o,resetAnalysisChangeListeners:T,triggerAllAnalysis:V,analysisChangeEvents:W,getSubIdPrefix:j,getSubElementById:l})}(jQuery),jQuery(window.tsfem_e_focus_inpost.load);
