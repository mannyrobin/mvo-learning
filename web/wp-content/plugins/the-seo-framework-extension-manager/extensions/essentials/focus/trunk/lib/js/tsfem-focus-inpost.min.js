'use strict';window.tsfem_e_focus_inpost=function(c){const d=tsfem_e_focusInpostL10n,e='#tsfem-e-focus-analysis-notification-area';var f={},g={},h={};const j=Z=>{return(/.*\[[0-9]+\]/.exec(Z)||'')[0]},k=(Z,_)=>{return Z+'['+_+']'},l=(Z,_)=>{return document.getElementById(Z+'['+_+']')},m=Z=>{return Object.keys(Z).sort((_,aa)=>{return Object.keys(_)[0]-Object.keys(aa)[0]}),Z},n=(Z,_)=>{if(Z&&Z===Object(Z)){let aa=f;_=!!_;let ba,ca;for(let da in Z)for(let ea in ba=Z[da],aa[da]||(aa[da]={}),ba)if(ca=ba[ea],aa[da][ca]||(aa[da][ca]=[]),_){let fa=Object.values(aa[da][ca]);if(-1<fa.indexOf(ea))continue;aa[da][ca].push(ea)}else aa[da][ca]=aa[da][ca].filter(fa=>fa!==ea);f=aa}},o=Z=>{const _=f;let aa=g,ba={},ca=!1,da='',ea=[];const fa=ha=>{ba=_[ha],ca=!1,da='',ea=[],'undefined'!=typeof ba.dominate&&ba.dominate.forEach(ia=>{document.querySelector(ia)&&(ca=!0,da=ia)}),ca||'undefined'==typeof ba.append||ba.append.forEach(ia=>{document.querySelector(ia)&&ea.push(ia)}),ca?aa[ha]=[da]:ea.length?aa[ha]=ea:ga(ha)},ga=ha=>{delete aa[ha]};if(Z)'undefined'==typeof _[Z]?ga(Z):fa(Z);else{for(var ha in _)fa(ha)}g=aa},p=Z=>{let fa,_=c(Z).data('scores'),aa=0,ba=0,ca=0,da=0,ea=0,ga=_.assessment.regex;ga!==Object(ga)&&(ga=[ga]);let ha=j(Z.id),ia=L(ha).get('inflections'),ja=L(ha).get('synonyms');const ka=ra=>{return ra=ra.match(/(?!>)[^<>]+(?=<|$)/gi),ra&&ra.join('').length||0},la=(ra,sa)=>{let ta,ua=tsfem_inpost.bewilderRegexNonWords(tsfem_inpost.escapeRegex(tsfem_inpost.escapeStr(ra,!0)));for(let va=0;va<ga.length&&(ta=/\/(.*)\/(.*)/.exec(ga[va]),sa=sa.match(new RegExp(ta[1].replace(/\{\{kw\}\}/g,ua),ta[2])),sa&&va!==ga.length-1);va++)sa=sa.join(' ');return sa&&sa.length||0},ma=(ra,sa)=>sa.replace(new RegExp(tsfem_inpost.escapeRegex(tsfem_inpost.escapeStr(ra,!0)),'gi'),'/'),na=ra=>{let sa=ia,ta=ra;return sa.length&&sa.sort((ua,va)=>va.length-ua.length),tsfem_inpost.promiseLoop(sa,ua=>{let va=la(ua,ta);aa+=va,ca+=ua.length*va,ta=ma(ua,ta)},5)},oa=ra=>{let sa=ja,ta=ra;return sa.length&&sa.sort((ua,va)=>va.length-ua.length),tsfem_inpost.promiseLoop(sa,ua=>{let va=la(ua,ta);ba+=va,da+=ua.length*va,ta=ma(ua,ta)},5)};c.when(tsfem_inpost.promiseLoop(g[_.assessment.content],ra=>{let sa=document.querySelector(ra),ta=c.Deferred();return(fa='undefined'==typeof sa.value?'':sa.value,fa.length||(fa=sa.innerHTML),!fa.length)?ta.resolve():(fa=tsfem_inpost.normalizeSpacing(fa).trim(),!fa.length)?ta.resolve():(ea+=ka(fa),c.when(na(fa),oa(fa)).done(()=>{ta.resolve()}),ta.promise())},5)).done(()=>{let ra=_.scoring,sa=0,ta=0;const ua=(Ca,Da)=>Da>Ca?Ca:Da,va=(Ca,Da)=>Math.floor(Da/Ca.per)*Ca.score,wa=(Ca,Da)=>Da*(Ca/100),xa=(Ca,Da)=>100*(Da/Ca),ya=(Ca,Da)=>Da/Ca.threshold*_.maxScore;switch(ra.type){case'n':aa&&(ta+=va(ra.keyword,ua(ra.keyword.max,aa))),ba&&(ta+=va(ra.synonym,ua(ra.synonym.max,ba)));break;case'p':ea&&(ca&&(sa+=xa(ea,wa(ra.keyword.weight,ca))),da&&(sa+=xa(ea,wa(ra.synonym.weight,da)))),ta=ya(ra,sa);}let za=document.querySelector('input[name="'+Z.id+'"]');za&&(za.value=ta);let Aa=Z.querySelector('.tsfem-e-focus-assessment-description'),Ba=q(_.phrasing,ta);Aa.innerHTML===Ba?(tsfem_inpost.setIconClass(Z.querySelector('.tsfem-e-focus-assessment-rating'),r(_.rating,ta)),Aa.style.opacity='1',Aa.style.willChange='auto'):(Aa.style.willChange='contents, opacity',Aa.style.opacity='0',Aa.innerHTML=Ba,tsfem_inpost.setIconClass(Z.querySelector('.tsfem-e-focus-assessment-rating'),r(_.rating,ta)),tsfem_inpost.fadeIn(Aa),Aa.style.willChange='auto')})},q=(Z,_)=>{let aa;for(let ba in Z=m(Z),Z)if(isFinite(ba)&&!isNaN(parseFloat(ba)))if(ba<=_)aa=Z[ba];else break;return aa?aa:Z[Object.keys(Z)[0]]},r=(Z,_)=>{let aa=q(Z,_).toString(),ba={0:'unknown',1:'bad',2:'warning',3:'okay',4:'good','-1':'error'};return'undefined'!=typeof ba[aa]&&ba[aa]||ba['-1']},t=Z=>{let _=l(Z,'keyword').value,aa=l(Z,'lexical_form');if(!(!aa instanceof HTMLInputElement)){D(Z).to('loading');const ba=da=>{let ea=l(Z,'lexical_selector'),fa=l(Z,'lexical_data'),ga=JSON.parse(d.defaultLexicalForm);ga=Object.values(ga),da.length&&(da.forEach(ia=>{ia.inflection&&ia.category&&ga.push({value:ia.inflection,category:ia.category,name:ia.category+': '+ia.inflection})}),z(Z).to('enabled'));let ha=ga.length&&JSON.stringify(ga)||d.defaultLexicalForm;aa.value='',fa instanceof HTMLInputElement&&(fa.value=ha),ea instanceof HTMLSelectElement&&(v(Z,ha),ea.disabled=!1,ea.selectedIndex=0)};c.when(((da,ea)=>{let fa={method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_e_focus_get_lexicalforms',nonce:d.nonce,post_ID:tsfem_inpost.postID,args:{keyword:ea,language:'en'}},timeout:15000,async:!0},ga=c.Deferred();return tsfem_inpost.doAjax(ga,fa,{noticeArea:e,premium:!0}),ga.promise()})(Z,_)).done(da=>{ba(da.forms)}).fail(()=>{u(Z,'lexical')}).always(()=>{D(Z).to('edit')})}},u=(Z,_)=>{const aa=()=>{let fa=l(Z,'lexical_form'),ga=l(Z,'lexical_selector'),ha=l(Z,'lexical_data');fa instanceof HTMLInputElement&&(fa.value=''),ha instanceof HTMLInputElement&&(ha.value=d.defaultLexicalForm),ga instanceof HTMLSelectElement&&(ga.disabled=!0,ga.selectedIndex=0,ga.dataset.prev=0,v(Z,d.defaultLexicalForm)),D(Z).to('unchecked')},ba=()=>{let fa=l(Z,'definition_dropdown'),ga=l(Z,'definition_selection');fa instanceof HTMLSelectElement&&(fa.selectedIndex=0,fa.innerHTML='',document.querySelector('[data-for="'+fa.id+'"]').innerHTML=''),ga instanceof HTMLInputElement&&(ga.value=''),L(Z).clearCache()},ca=()=>{let fa=l(Z,'inflections'),ga=fa&&fa.querySelector('.tsfem-e-focus-subject-selection'),ha=l(Z,'inflection_data'),ia=l(Z,'active_inflections');ga instanceof Element&&(ga.innerHTML=''),ha instanceof HTMLInputElement&&(ha.value=''),ia instanceof HTMLInputElement&&(ia.value=''),L(Z).clearCache('inflections')},da=()=>{let fa=l(Z,'synonyms'),ga=fa&&fa.querySelector('.tsfem-e-focus-subject-selection'),ha=l(Z,'synonym_data'),ia=l(Z,'active_synonyms');ga instanceof Element&&(ga.innerHTML=''),ha instanceof HTMLInputElement&&(ha.value=''),ia instanceof HTMLInputElement&&(ia.value=''),L(Z).clearCache('synonyms'),tsfem_inpost.isPremium&&J(Z)},ea=()=>{l(Z,'scores').querySelectorAll('input').forEach(fa=>fa.value=0)};switch(_){case'lexical':aa(),ba();break;case'definition':ba();break;case'inflections':ca();break;case'synonyms':da();break;case'ratings':ea();break;default:aa(),ba(),ca(),da(),ea();}},v=(Z,_)=>{let aa=l(Z,'lexical_selector');for(let da=aa.options.length;da--;)aa.remove(da);let ba=document.createElement('option'),ca=JSON.parse(_);if(ca)for(let da in ca)ba=ba.cloneNode(),ba.value=tsfem_inpost.escapeStr(da),ba.innerHTML=tsfem_inpost.escapeStr(ca[da].name),aa.appendChild(ba)};var w={};const x=Z=>{let _=Z.data.idPrefix,aa=l(_,'lexical_selector'),ba=l(_,'lexical_form'),ca=l(_,'lexical_data');const da=()=>{let ia=JSON.parse(ca.value),ja=ia[ba.value],ka={method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_e_focus_get_synonyms',nonce:d.nonce,post_ID:tsfem_inpost.postID,args:{form:ja,language:'en'}},timeout:15000,async:!0},la=c.Deferred();return tsfem_inpost.doAjax(la,ka,{noticeArea:e,premium:!0}),la.promise()},ea=ia=>{ba.value=ia,aa.value=ia,aa.selectedIndex=+ia},fa=()=>{u(_,'inflections');let ia=l(_,'keyword').value.toLowerCase(),ja=ba.value,ka=ca.value,la='',ma=[];return la=JSON.parse(ka)[ja].value.toLowerCase(),ma.push(ia),ia!==la&&ma.push(la),l(_,'inflection_data').value=JSON.stringify([{inflections:ma}]),c.Deferred().resolve()},ga=()=>{let ia=c.Deferred();return c.when(da()).done(ja=>{u(_,'definition'),u(_,'synonyms'),aa.dataset.prev=aa.value,l(_,'synonym_data').value=JSON.stringify(ja.synonyms),ia.resolve()}).fail(ja=>{1100202===ja||1100205===ja?(u(_,'definition'),u(_,'synonyms'),aa.dataset.prev=aa.value,l(_,'synonym_data').value='',ia.resolve()):(ea(aa.dataset.prev||0),ia.reject())}),ia.promise()};(()=>{D(_).to('loading'),clearTimeout(w[_]),w[_]=setTimeout(()=>{aa.dataset.prev==aa.value?D(_).to('edit'):(ea(aa.value),+aa.value?c.when(fa(),ga()).done(()=>{y(_),J(_),D(_).to('enabled, edit, checked')}).fail(()=>{D(_).to('edit')}):(aa.dataset.prev=aa.value,D(_).to('unchecked, disabled, edit'),u(_,'definition'),u(_,'inflections'),u(_,'synonyms')))},1500)})()},y=Z=>{let _=l(Z,'synonym_data'),aa=l(Z,'definition_dropdown'),ba=l(Z,'definition_selection'),ca=aa.cloneNode(!0),da=_.value&&JSON.parse(_.value)||{};for(let ga=ca.options.length;ga--;)ca.remove(ga);let ea=document.createElement('option');for(let ga=0;ga<da.length;ga++)ea=ea.cloneNode(),ea.value=ga,ea.innerHTML=tsfem_inpost.escapeStr(da[ga].example||d.i18n.noExampleAvailable),ca.appendChild(ea);aa.innerHTML=ca.innerHTML,aa.value=ba.value,aa.selectedIndex=+ba.value;let fa=l(Z,'definition_selector');aa.options.length?(c(document.querySelector('[data-for="'+aa.id+'"]')).trigger('set-tsfem-e-focus-definition'),fa.style.display=null):fa.style.display='none'},z=Z=>{const _=ba=>{c(ba).off('change.tsfemInpostLexical').on('change.tsfemInpostLexical',{idPrefix:Z},x)},aa=ba=>{c(ba).off('change.tsfemInpostLexical')};return{to:ba=>{let ca=l(Z,'lexical_selector');if(!(!ca instanceof HTMLSelectElement))switch(ba){case'enabled':_(ca);break;default:case'disabled':aa(ca);}}}},A=Z=>{let _=l(Z,'scores'),aa=_&&_.querySelectorAll('.tsfem-e-focus-assessment-wrap');if(!aa||aa!==Object(aa))C(Z).to('error');else{C(Z).to('enabled');for(let ba=aa.length;ba--;)B(aa[ba]);S(Z)}},B=Z=>{let _=j(Z.id),aa=l(_,'keyword').value;if(aa){let ba,ca,da,ea,fa;ca=Z.querySelector('.tsfem-e-focus-assessment-rating'),tsfem_inpost.setIconClass(ca,'loading'),da=!0,fa='undefined'!=typeof Z.dataset.assess&&!+Z.dataset.assess,ba=c(Z).data('scores'),ba&&ba.hasOwnProperty('assessment')&&'undefined'!=typeof g[ba.assessment.content]&&(Z.dataset.assess=1,N(Z,ba.assessment.content),da=!1),da?(tsfem_inpost.setIconClass(ca,'unknown'),Z.dataset.assess=0,ea=document.getElementsByName(Z.id),ea&&ea[0]&&(ea[0].value=0),tsfem_inpost.fadeOut(Z,250)):fa&&tsfem_inpost.fadeIn(Z,250)}},C=Z=>{let _=c(l(Z,'content')),aa=['.tsfem-e-focus-scores-wrap','.tsfem-e-focus-no-keyword-wrap','.tsfem-e-focus-something-wrong-wrap'];const ba=ca=>{aa.splice(aa.indexOf(ca),1),_.find(aa.join(', ')).fadeOut(150,()=>{setTimeout(()=>{_.find(ca).fadeIn(250)},150)})};return{to:ca=>{let da;switch(ca){case'disabled':da='.tsfem-e-focus-no-keyword-wrap';break;case'enabled':da='.tsfem-e-focus-scores-wrap';break;default:case'error':da='.tsfem-e-focus-something-wrong-wrap';}ba(da)}}},D=Z=>{return{to:_=>{let aa=l(Z,'subject_edit');if(aa&&!(!aa instanceof HTMLInputElement)){let ba=document.querySelector('label[for="'+aa.id+'"]'),ca=aa.parentNode,da='tsfem-e-focus-edit-subject-button-wrap-disabled';_.split(',').forEach(ea=>{switch(ea.trim()){case'checked':aa.checked||(aa.checked=!0,c(aa).trigger('change'));break;case'unchecked':aa.checked&&(aa.checked=!1,c(aa).trigger('change'));break;case'loading':ba&&tsfem_inpost.setIconClass(ba,'loading');break;case'edit':ba&&tsfem_inpost.setIconClass(ba,'edit');break;case'enabled':aa.disabled=!1,ca.classList.toggle(da,!1);break;case'disabled':aa.disabled=!0,ca.classList.toggle(da,!0);break;default:}})}}}},E=()=>{c('.tsfem-e-focus-collapse-header').off('dblclick.tsfem-e-focus').on('dblclick.tsfem-e-focus',_=>{if(!tsfem_inpost.isActionableElement(_.target)){let aa=c(_.target).closest('.tsfem-e-focus-collapse-wrap'),ba=j(aa.attr('id')),ca=l(ba,'collapser');ca instanceof HTMLInputElement&&(ca.checked=!ca.checked)}})},F=()=>{let Z={},_=1500,aa=3,ca={},da={},ea=_/(100*aa);ea*=1.175;const fa=(ja,ka)=>{ka.style.width=++ca[ja]/aa+'%'},ga=(ja,ka)=>{ca[ja]=0,ka.style.width='0%'};let ha=c('.tsfem-e-focus-keyword-entry');const ia=ja=>{let ka=ja.target,la=ka.value.trim().replace(/[\s\t\r\n]+/g,' ')||'',ma=ka.dataset.prev||'';if(ja.target.value=la,la!==ma){let na=j(ja.target.id);return ka.dataset.prev=la,u(na),D(na).to('disabled, edit'),c(l(na,'scores')).find('.tsfem-e-focus-assessment-description').css('opacity','0'),la.length?void(tsfem_inpost.isPremium&&d.languageSupported&&t(na),A(na)):(C(na).to('disabled'),void z(na).to('disabled'))}};ha.off('input.tsfem-e-focus').on('input.tsfem-e-focus',ja=>{let ka=j(ja.target.id),la=l(ka,'content').querySelector('.tsfem-e-focus-content-loader-bar'),ma=l(ka,'collapser');ma.checked&&(ma.checked=!1,c(ma).trigger('change')),clearInterval(da[ka]),clearTimeout(Z[ka]),ga(ka,la),da[ka]=setInterval(()=>fa(ka,la),ea),Z[ka]=setTimeout(()=>{clearInterval(da[ka]),ia(ja),ga(ka,la)},_)}),ha.each((ja,ka)=>{if(!ka.value.length){let la=j(ka.id);u(la)}})},G=()=>{const Z=fa=>{let ha,ia,ja,ka,ga=fa.target,la=0,ma='',na=0,oa='',pa=fa.data&&fa.data.change||!1;if('undefined'!=typeof ga.dataset.for&&(ha=ga.dataset.for),!ha)return!1;if(ia=document.getElementById(ha),ka=j(ha),ja=l(ka,'definition_selection'),!ia)return!1;la=ia.value,ma=ga.innerHTML;const qa=()=>{ga.innerHTML=oa,ia.value=na,ja.value=na,+na!=+la&&(l(ka,'active_synonyms').value='',l(ka,'active_inflections').value='',J(ka)),xa()},ta=()=>{c(ia).blur().hide(),c(ga).fadeIn(300)},ua=Ba=>{va(Ba.target),+na==+la&&xa()||qa()},va=Ba=>{na=Ba.value,oa=Ba.options[Ba.selectedIndex].text},wa=Ba=>{let Ca=c(Ba.target).closest(ia);1>Ca.length&&xa()},xa=()=>{return Aa(),ta(),!0},ya=()=>{va(ia),qa()},Aa=()=>{ia.removeEventListener('blur',xa),ia.removeEventListener('change',ua),window.removeEventListener('click',wa)};(()=>{c(ga).hide(),c(ia).slideDown(200).focus()})(),setTimeout(()=>{ia.addEventListener('blur',xa),ia.addEventListener('change',ua),window.addEventListener('click',wa),pa&&ya()},10)};let ba='click.tsfem-e-focus-definition-editor',ca='keypress.tsfem-e-focus-definition-editor',da='set-tsfem-e-focus-definition';c('.tsfem-e-focus-definition-editor').off(ba).on(ba,Z).off(ca).on(ca,fa=>{32==fa.which&&(fa.preventDefault(),Z(fa))}).off(da).on(da,{change:1},Z);let ea='change.tsfem-e-focus-edit-subject-toggle';c('.tsfem-e-focus-edit-subject-checkbox').off(ea).on(ea,fa=>{let ga=j(fa.target.id),ha=l(ga,'edit'),ia=l(ga,'evaluate'),ja=l(ga,'collapser');ja.checked?(fa.target.checked=!0,ia.style.display='none',ia.style.opacity=0,ha.style.display=null,ha.style.opacity=1,ja.checked=!1):fa.target.checked?tsfem_inpost.fadeOut(ia,150,{cb:()=>{tsfem_inpost.fadeIn(ha,250),fa.target.checked=!0},promise:!1}):tsfem_inpost.fadeOut(ha,150,{cb:()=>{tsfem_inpost.fadeIn(ia,250),fa.target.checked=!1},promise:!1})})};var H={};const I=()=>{const Z=fa=>(/\[([0-9]+)\]$/.exec(fa)||'')[1],_=fa=>{let ga=l(fa,'inflections'),ha=ga.querySelectorAll('input:checked'),ia=[];ha.forEach(ja=>{ia.push(Z(ja.id))}),l(fa,'active_inflections').value=ia.join(),L(fa).clearCache('inflections'),S(fa)},aa=fa=>{let ga=l(fa,'synonyms'),ha=ga.querySelectorAll('input:checked'),ia=[];ha.forEach(ja=>{ia.push(Z(ja.id))}),l(fa,'active_synonyms').value=ia.join(),L(fa).clearCache('synonyms'),S(fa)},ba=fa=>{let ga=fa.data.idPrefix,ha=fa.data.type,ia=ga+ha;clearTimeout(H[ia]),H[ia]=setTimeout(()=>{'inflections'===ha?_(ga):'synonyms'===ha?aa(ga):void 0},1500)},ca=(fa,ga)=>{c(l(fa,ga)).find('input').off('change.tsfem-e-focus').on('change.tsfem-e-focus',{idPrefix:fa,type:ga},ba)};let ea='tsfem-e-focus-updated-subject.tsfem-e-focus';c(window).off(ea).on(ea,(fa,ga)=>{if(ga&&ga.idPrefix){const ha=ga.idPrefix,ia=l(ha,'inflection_data'),ja=l(ha,'synonym_data'),ka=l(ha,'definition_selection'),la=l(ha,'inflections'),ma=l(ha,'synonyms'),na=la.querySelector('.tsfem-e-focus-subject-selection'),oa=ma.querySelector('.tsfem-e-focus-subject-selection'),pa=wp.template('tsfem-e-focus-subject-item');let qa=ia.value&&JSON.parse(ia.value),ra=qa&&qa[0].inflections||{},sa=ja.value&&JSON.parse(ja.value),ta=sa&&sa[+ka.value]&&sa[+ka.value].synonyms||{};na.style.opacity=0,oa.style.opacity=0;let ua=l(ha,'active_inflections').value.split(','),va=l(ha,'active_synonyms').value.split(','),wa='',xa=k(ha,'inflection');for(let ya in ra)wa+=pa({id:k(xa,ya),value:ra[ya],checked:!+ya||-1<ua.indexOf(ya+'')?'checked':'',disabled:+ya?'':'disabled'});for(let ya in na.innerHTML=wa,wa='',xa=k(ha,'synonym'),ta)wa+=pa({id:k(xa,ya),value:ta[ya],checked:-1<va.indexOf(ya+'')?'checked':''});oa.innerHTML=wa,ra.length?(la.style.display=null,tsfem_inpost.fadeIn(na)):la.style.display='none',ta.length?(ma.style.display=null,tsfem_inpost.fadeIn(oa)):ma.style.display='none',_(ha),aa(ha),ca(ha,'inflections'),ca(ha,'synonyms')}})},J=Z=>{c(window).trigger('tsfem-e-focus-updated-subject',[{idPrefix:Z}])};var K={};const L=Z=>{L.hasOwnProperty(Z)||(K[Z]={},K[Z].inflections=null,K[Z].synonyms=null);const _=()=>{let da,ea,fa=l(Z,'active_inflections');if(fa instanceof HTMLInputElement&&fa.value){let ga=l(Z,'inflection_data').value;ea=JSON.parse(ga)[0].inflections,da=[],fa.value.split(',').forEach(ha=>{da.push(ea[+ha])})}if(!da){let ga=l(Z,'keyword').value;da=ga&&[ga]||!1}return da=da||!1,K[Z].inflections=da,da},aa=()=>{let da,ea,fa=l(Z,'active_synonyms'),ga=l(Z,'definition_selection');if(fa instanceof HTMLInputElement&&fa.value){let ha=l(Z,'synonym_data').value;ea=JSON.parse(ha)[+ga.value].synonyms,da=[],fa.value.split(',').forEach(ia=>{da.push(ea[+ia])})}return da=da||!1,K[Z].synonyms=da,da},ba=da=>{if(null!==K[Z][da])return K[Z][da];return'inflections'===da?_():'synonyms'===da?aa():{inflections:_(),synonyms:aa()}},ca=da=>{da?delete K[Z][da]:delete K[Z]};return{get:da=>ba(da),clearCache:da=>ca(da)}},M=(Z,_)=>{if('undefined'!=typeof h[Z]){_=_||'unknown';for(let aa=h[Z].length;aa--;)tsfem_inpost.setIconClass(document.getElementById(h[Z][aa]).querySelector('.tsfem-e-focus-assessment-rating'),_)}},N=(Z,_)=>{let aa=h;aa&&aa===Object(aa)||(aa=[]),aa[_]&&aa[_]===Object(aa[_])||(aa[_]=[]),Z.id&&('undefined'==typeof g[_]?delete aa[_][Z.id]:0>aa[_].indexOf(Z.id)&&aa[_].push(Z.id)),h=aa};var O={},P={};const Q=Z=>{const _=ca=>{tsfem_inpost.promiseLoop(h[ca],da=>{let ea=j(da),fa=l(ea,'keyword'),ga=fa.value||'';if(ga.length){let ha=document.getElementById(da),ia=ha.querySelector('.tsfem-e-focus-assessment-rating');tsfem_inpost.setIconClass(ia,'loading'),setTimeout(()=>p(ha),150)}})},aa=ca=>{'undefined'==typeof h[ca.data.type]||(clearTimeout(O[ca.data.type]),!P[ca.data.type]&&(setTimeout(()=>tsfem_inpost.setIconClass(document.querySelectorAll('[data-assessment-type="'+ca.data.type+'"] .tsfem-e-focus-assessment-rating'),'unknown'),0),P[ca.data.type]=!0),O[ca.data.type]=setTimeout(()=>{_(ca.data.type),P[ca.data.type]=!1},1500))},ba=ca=>{let da=T(ca).get('names');c(g[ca].join(', ')).off(da).on(da,{type:ca},aa)};if(Z)'undefined'!=typeof g[Z]&&ba(Z);else for(let ca in g)'undefined'!=typeof g[ca]&&ba(ca)};var R={};const S=Z=>{Z=Z||0,clearTimeout(R[Z]),R[Z]=setTimeout(()=>{if(Z){let _=l(Z,'scores'),aa=_&&_.querySelectorAll('.tsfem-e-focus-assessment-wrap[data-assess="1"]');aa instanceof NodeList&&aa.length?tsfem_inpost.promiseLoop(aa,ba=>{tsfem_inpost.setIconClass(ba.querySelector('.tsfem-e-focus-assessment-rating'),'loading'),p(ba)},100):C(Z).to('error')}else{for(var _ in g)c(g[_].join(', ')).trigger(T(_).get('trigger'))}},1e3)},T=Z=>{const _=['tsfem-e-focus.analysis-'+Z,'input.tsfem-e-focus-'+Z,'change.tsfem-e-focus-'+Z];return{get:aa=>{return'names'===aa?_.join(' '):'trigger'===aa?_[0]:_}}},U=()=>{let Z=c(document),_=document.getElementById('tsf-gutenberg-data-holder');if(_){const aa=ia=>`tsfem-focus-gbc-${ia}`,ba=ia=>document.getElementById(aa(ia)),ca=(ia,ja)=>{da(ia),setTimeout(()=>{o(ja),Q(ja)}),Z.trigger(`tsfem-focus-gutenberg-${ia}-store-set`)},da=ia=>{if(!ba(ia)){let ja=document.createElement('div');ja.id=aa(ia),ja.style.display='none',_.appendChild(ja)}},fa=(ia,ja)=>{ba(ia).innerHTML=ja},ga=(ia,ja)=>{c('#'+aa(ia)).trigger(T(ja).get('trigger'))};Z.on('tsf-updated-gutenberg-title',(ia,ja)=>{fa('title',ja),ga('title','pageTitle')}),ca('title','pageTitle'),Z.on('tsf-updated-gutenberg-link',(ia,ja)=>{fa('link',ja),ga('link','pageUrl')}),ca('link','pageUrl');const ha=ia=>{fa('content',ia),ga('content','pageContent')};Z.on('tsf-updated-gutenberg-content',(ia,ja)=>{let ka=lodash.debounce(ha,500);wp.data.select('core/editor').isTyping()?(M('pageContent','unknown'),ka(ja)):(ka.cancel(),ha(ja))}),ca('content','pageContent')}},V=()=>{const Z=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;(()=>{if('undefined'!=typeof d.focusElements.pageUrl){let _=document.getElementById('edit-slug-box');if(_&&!(!_ instanceof HTMLElement)){const aa=()=>{let ba=document.querySelectorAll('.tsfem-e-focus-assessment-wrap[data-assessment-type="url"][data-assess="0"]');ba instanceof NodeList&&ba.length&&(o('pageUrl'),Q('pageUrl'),ba.forEach(ca=>B(ca)))};new Z(()=>{aa(),Q('pageUrl'),c('#sample-permalink').trigger(T('pageUrl').get('trigger'))}).observe(_,{childList:!0,subtree:!0})}}})(),(()=>{if('undefined'!=typeof tinyMCE&&'function'==typeof tinyMCE.on){let _=!1;tinyMCE.on('addEditor',aa=>{if(!_&&'content'===aa.editor.id){_=!0,o('pageContent'),Q('pageContent');let ba={},ca=tinyMCE.get('content'),da=!1,ea=!1;ca.on('Dirty',()=>{ea||(M('pageContent','unknown'),ea=!0)}),ca.on('GetContent',()=>{clearTimeout(ba.GetContent),!da&&ca.isDirty()&&(M('pageContent','loading'),da=!0,ea=!1),ba.GetContent=setTimeout(()=>{ca.isDirty()||c('#content').trigger(T('pageContent').get('trigger')),da=!1,ea=!1},1e3)})}})}})()},W=()=>{d.isGutenbergPage?U():V()},X=()=>{let Z=document.querySelectorAll('.tsfem-e-focus-collapse-wrap');for(let _=Z.length;_--;){let aa=j(Z[_].id),ba=l(aa,'keyword');if(ba.value.length){if(ba.dataset.prev=ba.value,tsfem_inpost.isPremium){let ca=l(aa,'lexical_selector');ca.dataset.prev=ca.value,1<ca.length?z(aa).to('enabled'):u(aa,'lexical'),+ca.value&&(D(aa).to('enabled'),y(aa),J(aa))}A(aa)}}},Y=()=>{if(W(),d.hasOwnProperty('focusElements')&&(n(d.focusElements,!0),o(),Q()),0===Object.keys(g).length){let _=document.getElementById('tsfem-e-focus-analysis-wrap');if(_ instanceof Element){let aa=_.querySelector('.tsf-flex-setting-input');aa instanceof Element&&(aa.innerHTML=wp.template('tsfem-e-focus-nofocus')())}return}E(),F(),tsfem_inpost.isPremium&&(G(),I()),X()};return c.extend({load:function(){c('.tsfem-e-focus-enable-if-js').removeProp('disabled'),c('.tsfem-e-focus-disable-if-js').prop('disabled','disabled'),c('.tsfem-e-focus-requires-javascript').removeClass('tsfem-e-focus-requires-javascript'),c(document.body).ready(Y)}},{focusRegistry:f,activeFocusAreas:g,activeAssessments:h,updateFocusRegistry:n,updateActiveFocusAreas:o,resetAnalysisChangeListeners:Q,triggerAllAnalysis:S,analysisChangeEvents:T,getSubIdPrefix:j,getSubElementById:l})}(jQuery),jQuery(window.tsfem_e_focus_inpost.load);
