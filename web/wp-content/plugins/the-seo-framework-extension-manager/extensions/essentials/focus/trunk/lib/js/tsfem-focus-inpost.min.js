'use strict';window.tsfem_e_focus_inpost=function(a){const b=tsfem_e_focusInpostL10n,c="#tsfem-e-focus-analysis-notification-area";let d={},e={},f={};const g=a=>(/.*\[[0-9]+\]/.exec(a)||"")[0],h=(a,b)=>a+"["+b+"]",i=(a,b)=>document.getElementById(a+"["+b+"]"),j=a=>(Object.keys(a).sort((c,a)=>Object.keys(c)[0]-Object.keys(a)[0]),a),k=(a,b)=>{if(!a||a!==Object(a))return;let c=d;b=!!b;let e,f;for(let d in a)for(let g in e=a[d],c[d]||(c[d]={}),e)if(f=e[g],c[d][f]||(c[d][f]=[]),b){let a=Object.values(c[d][f]);if(-1<a.indexOf(g))continue;c[d][f].push(g)}else c[d][f]=c[d][f].filter(a=>a!==g);d=c},l=a=>{const b=d;let c=e,f={},g=!1,h="",i=[];const j=a=>{f=b[a],g=!1,h="",i=[],"undefined"!=typeof f.dominate&&f.dominate.forEach(a=>{document.querySelector(a)&&(g=!0,h=a)}),g||"undefined"==typeof f.append||f.append.forEach(a=>{document.querySelector(a)&&i.push(a)}),g?c[a]=[h]:i.length?c[a]=i:k(a)},k=a=>{delete c[a]};if(a)"undefined"==typeof b[a]?k(a):j(a);else{for(var l in b)j(l)}e=c};let m={};const n=c=>{let d=g(c.id),f="e_focus_pw_"+a(c).data("assessment-type")+"_"+d,h=c.querySelector(".tsfem-e-focus-assessment-rating");if(tsfem_inpost.isWorkerBusy(f))return f in m&&clearTimeout(m[f]),void(m[f]=setTimeout(()=>n(c),2e3));delete m[f],tsfem_inpost.occupyWorker(f),tsfem_inpost.setIconClass(h,"loading");let i,j=K(d).get("inflections"),k=K(d).get("synonyms"),l=a(c).data("scores"),q=0,r=0,s=0,t=0,u=0,v=l.assessment.regex;v!==Object(v)&&(v=[v]);const w=c=>{let d=document.querySelector(c),e=a.Deferred();return(i="undefined"==typeof d.value?"":d.value,i.length||(i=d.innerHTML),!i.length)?e.resolve():(setTimeout(async()=>{await(tsfem_inpost.getWorker(f)||tsfem_inpost.spawnWorker(b.scripts.parserWorker,f)),a.when(tsfem_inpost.tellWorker(f,{regex:v,inflections:j,synonyms:k,content:i,assess:{getCharCount:"p"===l.scoring.type}})).done(a=>{q=a.inflectionCount,r=a.synonymCount,s=a.inflectionCharCount,t=a.synonymCharCount,u=a.contentCharCount,e.resolve()}).fail(()=>{e.reject()})}),e.promise())},x=()=>{let a=l.scoring,b=0,d=0;const e=(a,b)=>b>a?a:b,f=(a,b)=>Math.floor(b/a.per)*a.score,g=(a,b)=>b*(a/100),i=(a,b)=>100*(b/a),j=(a,b)=>b/a.threshold*l.maxScore;switch(a.type){case"n":q&&(d+=f(a.keyword,e(a.keyword.max,q))),r&&(d+=f(a.synonym,e(a.synonym.max,r)));break;case"p":u&&(s&&(b+=i(u,g(a.keyword.weight,s))),t&&(b+=i(u,g(a.synonym.weight,t)))),d=j(a,b);}let k=document.querySelector("input[name=\""+c.id+"\"]");k&&(k.value=d);let m=c.querySelector(".tsfem-e-focus-assessment-description"),n=o(l.phrasing,d);m.innerHTML===n?(tsfem_inpost.setIconClass(h,p(l.rating,d)),m.style.opacity="1",m.style.willChange="auto"):(m.style.willChange="contents, opacity",m.style.opacity="0",m.innerHTML=n,tsfem_inpost.setIconClass(h,p(l.rating,d)),tsfem_inpost.fadeIn(m),m.style.willChange="auto")},y=()=>{let a=document.querySelector("input[name=\""+c.id+"\"]");a&&(a.value=0);let d=c.querySelector(".tsfem-e-focus-assessment-description"),e=b.i18n.parseFailure;d.innerHTML===e?(tsfem_inpost.setIconClass(h,p(-1,-1)),d.style.opacity="1",d.style.willChange="auto"):(d.style.willChange="contents, opacity",d.style.opacity="0",d.innerHTML=e,tsfem_inpost.setIconClass(h,p(-1,-1)),tsfem_inpost.fadeIn(d),d.style.willChange="auto")};a.when(tsfem_inpost.promiseLoop(e[l.assessment.content],w,5,3e4)).done(()=>{x(),tsfem_inpost.freeWorker(f)}).fail(()=>{y(),tsfem_inpost.despawnWorker(f)})},o=(a,b)=>{let c;for(let d in a=j(a),a)if(isFinite(d)&&!isNaN(parseFloat(d)))if(d<=b)c=a[d];else break;return c?c:a[Object.keys(a)[0]]||""},p=(a,b)=>{let c=o(a,b).toString(),d={"-1":"error",0:"unknown",1:"bad",2:"warning",3:"okay",4:"good"};return"undefined"!=typeof d[c]&&d[c]||d["-1"]},q=d=>{let e=i(d,"keyword").value,f=i(d,"lexical_form");if(!f instanceof HTMLInputElement)return;C(d).to("loading");const g=a=>{let c=i(d,"lexical_selector"),e=i(d,"lexical_data"),g=Object.values(JSON.parse(b.defaultLexicalForm));a.length&&(a.forEach(a=>{a.inflection&&a.category&&g.push({value:a.inflection,category:a.category,name:a.category+": "+a.inflection})}),w(d).to("enabled"));let h=g.length&&JSON.stringify(g)||b.defaultLexicalForm;f.value="",e instanceof HTMLInputElement&&(e.value=h),c instanceof HTMLSelectElement&&(s(d,h),c.disabled=!1,c.selectedIndex=0)};a.when(((d,e)=>{let f={method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfem_e_focus_get_lexicalforms",nonce:b.nonce,post_ID:tsfem_inpost.postID,args:{keyword:e,language:"en"}},timeout:15e3,async:!0},g=a.Deferred();return tsfem_inpost.doAjax(g,f,{noticeArea:c,premium:!0}),g.promise()})(d,e)).done(a=>{g(a.forms)}).fail(()=>{r(d,"lexical")}).always(()=>{C(d).to("edit")})},r=(a,c)=>{const d=()=>{let c=i(a,"lexical_form"),d=i(a,"lexical_selector"),e=i(a,"lexical_data");c instanceof HTMLInputElement&&(c.value=""),e instanceof HTMLInputElement&&(e.value=b.defaultLexicalForm),d instanceof HTMLSelectElement&&(d.disabled=!0,d.selectedIndex=0,d.dataset.prev=0,s(a,b.defaultLexicalForm)),C(a).to("unchecked")},e=()=>{let b=i(a,"definition_dropdown"),c=i(a,"definition_selection");b instanceof HTMLSelectElement&&(b.selectedIndex=0,b.innerHTML="",document.querySelector("[data-for=\""+b.id+"\"]").innerHTML=""),c instanceof HTMLInputElement&&(c.value=""),K(a).clearCache()},f=()=>{let b=i(a,"inflections"),c=b&&b.querySelector(".tsfem-e-focus-subject-selection"),d=i(a,"inflection_data"),e=i(a,"active_inflections");c instanceof Element&&(c.innerHTML=""),d instanceof HTMLInputElement&&(d.value=""),e instanceof HTMLInputElement&&(e.value=""),K(a).clearCache("inflections")},g=()=>{let b=i(a,"synonyms"),c=b&&b.querySelector(".tsfem-e-focus-subject-selection"),d=i(a,"synonym_data"),e=i(a,"active_synonyms");c instanceof Element&&(c.innerHTML=""),d instanceof HTMLInputElement&&(d.value=""),e instanceof HTMLInputElement&&(e.value=""),K(a).clearCache("synonyms"),tsfem_inpost.isPremium&&I(a)},h=()=>{i(a,"scores").querySelectorAll("input").forEach(a=>a.value=0)};switch(c){case"lexical":d(),e();break;case"definition":e();break;case"inflections":f();break;case"synonyms":g();break;case"ratings":h();break;default:d(),e(),f(),g(),h();}},s=(a,b)=>{let c=i(a,"lexical_selector");for(let d=c.options.length;d--;)c.remove(d);let d=document.createElement("option"),e=JSON.parse(b);if(e)for(let a in e)d=d.cloneNode(),d.value=tsfem_inpost.escapeStr(a),d.innerHTML=tsfem_inpost.escapeStr(e[a].name),c.appendChild(d)};let t={};const u=d=>{let e=d.data.idPrefix,f=i(e,"lexical_selector"),g=i(e,"lexical_form"),h=i(e,"lexical_data");const j=()=>{let d=JSON.parse(h.value),e=d[g.value],f={method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfem_e_focus_get_synonyms",nonce:b.nonce,post_ID:tsfem_inpost.postID,args:{form:e,language:"en"}},timeout:15e3,async:!0},i=a.Deferred();return tsfem_inpost.doAjax(i,f,{noticeArea:c,premium:!0}),i.promise()},k=a=>{g.value=a,f.value=a,f.selectedIndex=+a},l=()=>{r(e,"inflections");let b=i(e,"keyword").value.toLowerCase(),c=g.value,d=h.value,f="",j=[];return f=JSON.parse(d)[c].value.toLowerCase(),j.push(b),b!==f&&j.push(f),i(e,"inflection_data").value=JSON.stringify([{inflections:j}]),a.Deferred().resolve()},m=()=>{let b=a.Deferred();return a.when(j()).done(a=>{r(e,"definition"),r(e,"synonyms"),f.dataset.prev=f.value,i(e,"synonym_data").value=JSON.stringify(a.synonyms),b.resolve()}).fail(a=>{1100202===a||1100205===a?(r(e,"definition"),r(e,"synonyms"),f.dataset.prev=f.value,i(e,"synonym_data").value="",b.resolve()):(k(f.dataset.prev||0),b.reject())}),b.promise()};(()=>{C(e).to("loading"),clearTimeout(t[e]),t[e]=setTimeout(()=>{f.dataset.prev==f.value?C(e).to("edit"):(k(f.value),+f.value?a.when(l(),m()).done(()=>{v(e),I(e),C(e).to("enabled, edit, checked")}).fail(()=>{C(e).to("edit")}):(f.dataset.prev=f.value,C(e).to("unchecked, disabled, edit"),r(e,"definition"),r(e,"inflections"),r(e,"synonyms")))},1500)})()},v=c=>{let d=i(c,"synonym_data"),e=i(c,"definition_dropdown"),f=i(c,"definition_selection"),g=e.cloneNode(!0),h=d.value&&JSON.parse(d.value)||{};for(let a=g.options.length;a--;)g.remove(a);let j=document.createElement("option");for(let a=0;a<h.length;a++)j=j.cloneNode(),j.value=a,j.innerHTML=tsfem_inpost.escapeStr(h[a].example||b.i18n.noExampleAvailable),g.appendChild(j);e.innerHTML=g.innerHTML,e.value=f.value,e.selectedIndex=+f.value;let k=i(c,"definition_selector");e.options.length?(a(document.querySelector("[data-for=\""+e.id+"\"]")).trigger("set-tsfem-e-focus-definition"),k.style.display=null):k.style.display="none"},w=b=>{const c=c=>{a(c).off("change.tsfemInpostLexical").on("change.tsfemInpostLexical",{idPrefix:b},u)},d=b=>{a(b).off("change.tsfemInpostLexical")};return{to:a=>{let e=i(b,"lexical_selector");if(!(!e instanceof HTMLSelectElement))switch(a){case"enabled":c(e);break;default:case"disabled":d(e);}}}},x=a=>{let b=i(a,"scores"),c=b&&b.querySelectorAll(".tsfem-e-focus-assessment-wrap");if(z(a).to("disabled"),!c||c!==Object(c))B(a).to("error");else{B(a).to("enabled");for(let a=c.length;a--;)A(c[a]);R(a),z(a).to("enabled")}};let y={};const z=a=>({to:c=>{switch(c){case"disabled":a in y&&(clearInterval(y[a]),delete y[a]);break;case"enabled":z(a).to("disabled"),4999<b.settings.analysisInterval&&(y[a]=setInterval(()=>R(a),b.settings.analysisInterval));break;default:}}}),A=b=>{let c=g(b.id),d=i(c,"keyword").value;if(!d)return;let f,h,j,k,l;h=b.querySelector(".tsfem-e-focus-assessment-rating"),tsfem_inpost.setIconClass(h,"loading"),j=!0,l="undefined"!=typeof b.dataset.assess&&!+b.dataset.assess,f=a(b).data("scores"),f&&f.hasOwnProperty("assessment")&&"undefined"!=typeof e[f.assessment.content]&&(b.dataset.assess=1,M(b,f.assessment.content),j=!1),j?(tsfem_inpost.setIconClass(h,"unknown"),b.dataset.assess=0,k=document.getElementsByName(b.id),k&&k[0]&&(k[0].value=0),tsfem_inpost.fadeOut(b,250)):l&&tsfem_inpost.fadeIn(b,250)},B=b=>{let c=a(i(b,"content")),d=[".tsfem-e-focus-scores-wrap",".tsfem-e-focus-no-keyword-wrap",".tsfem-e-focus-something-wrong-wrap"];const e=a=>{d.splice(d.indexOf(a),1),c.find(d.join(", ")).fadeOut(150,()=>{setTimeout(()=>{c.find(a).fadeIn(250)},150)})};return{to:a=>{let b;switch(a){case"disabled":b=".tsfem-e-focus-no-keyword-wrap";break;case"enabled":b=".tsfem-e-focus-scores-wrap";break;default:case"error":b=".tsfem-e-focus-something-wrong-wrap";}e(b)}}},C=b=>({to:c=>{let d=i(b,"subject_edit");if(!d||!d instanceof HTMLInputElement)return;let e=document.querySelector("label[for=\""+d.id+"\"]"),f=d.parentNode,g="tsfem-e-focus-edit-subject-button-wrap-disabled";c.split(",").forEach(b=>{switch(b.trim()){case"checked":d.checked||(d.checked=!0,a(d).trigger("change"));break;case"unchecked":d.checked&&(d.checked=!1,a(d).trigger("change"));break;case"loading":e&&tsfem_inpost.setIconClass(e,"loading");break;case"edit":e&&tsfem_inpost.setIconClass(e,"edit");break;case"enabled":d.disabled=!1,f.classList.toggle(g,!1);break;case"disabled":d.disabled=!0,f.classList.toggle(g,!0);break;default:}})}}),D=()=>{a(".tsfem-e-focus-collapse-header").off("dblclick.tsfem-e-focus").on("dblclick.tsfem-e-focus",b=>{if(!tsfem_inpost.isActionableElement(b.target)){let c=a(b.target).closest(".tsfem-e-focus-collapse-wrap"),d=g(c.attr("id")),e=i(d,"collapser");e instanceof HTMLInputElement&&(e.checked=!e.checked)}})},E=()=>{let c={},d=3,e={},f={},h=1500/(100*d);!0&&(h*=1.175);const j=(a,b)=>{b.style.width=++e[a]/d+"%"},k=(a,b)=>{e[a]=0,b.style.width="0%"};let l=a(".tsfem-e-focus-keyword-entry");const m=c=>{let d=c.target,e=d.value.trim().replace(/[\s\t\r\n]+/g," ")||"",f=d.dataset.prev||"";if(c.target.value=e,e!==f){let f=g(c.target.id);return d.dataset.prev=e,r(f),C(f).to("disabled, edit"),z(f).to("disabled"),a(i(f,"scores")).find(".tsfem-e-focus-assessment-description").css("opacity","0"),e.length?void(tsfem_inpost.isPremium&&b.languageSupported&&q(f),x(f)):(B(f).to("disabled"),void w(f).to("disabled"))}};l.off("input.tsfem-e-focus").on("input.tsfem-e-focus",b=>{let d=g(b.target.id),e=i(d,"content").querySelector(".tsfem-e-focus-content-loader-bar"),l=i(d,"collapser");l.checked&&(l.checked=!1,a(l).trigger("change")),clearInterval(f[d]),clearTimeout(c[d]),k(d,e),f[d]=setInterval(()=>j(d,e),h),c[d]=setTimeout(()=>{clearInterval(f[d]),m(b),k(d,e)},1500)}),l.each((a,b)=>{if(!b.value.length){let a=g(b.id);r(a)}})},F=()=>{const b=b=>{let c,d,e,f,h=b.target,j=0,k="",l=0,m="",n=b.data&&b.data.change||!1;if("undefined"!=typeof h.dataset.for&&(c=h.dataset.for),!c)return!1;if(d=document.getElementById(c),f=g(c),e=i(f,"definition_selection"),!d)return!1;j=d.value,k=h.innerHTML;const o=()=>{h.innerHTML=m,d.value=l,e.value=l,+l!=+j&&(i(f,"active_synonyms").value="",i(f,"active_inflections").value="",I(f)),u()},p=()=>{a(h).hide(),a(d).slideDown(200).focus()},q=()=>{a(d).blur().hide(),a(h).fadeIn(300)},r=a=>{s(a.target),+l==+j&&u()||o()},s=a=>{l=a.value,m=a.options[a.selectedIndex].text},t=b=>{let c=a(b.target).closest(d);1>c.length&&u()},u=()=>(x(),q(),!0),v=()=>{s(d),o()},w=()=>{d.addEventListener("blur",u),d.addEventListener("change",r),window.addEventListener("click",t),n&&v()},x=()=>{d.removeEventListener("blur",u),d.removeEventListener("change",r),window.removeEventListener("click",t)};p(),setTimeout(w,10)};a(".tsfem-e-focus-definition-editor").off("click.tsfem-e-focus-definition-editor").on("click.tsfem-e-focus-definition-editor",b).off("keypress.tsfem-e-focus-definition-editor").on("keypress.tsfem-e-focus-definition-editor",a=>{32==a.which&&(a.preventDefault(),b(a))}).off("set-tsfem-e-focus-definition").on("set-tsfem-e-focus-definition",{change:1},b);a(".tsfem-e-focus-edit-subject-checkbox").off("change.tsfem-e-focus-edit-subject-toggle").on("change.tsfem-e-focus-edit-subject-toggle",a=>{let b=g(a.target.id),c=i(b,"edit"),d=i(b,"evaluate"),e=i(b,"collapser");e.checked?(a.target.checked=!0,d.style.display="none",d.style.opacity=0,c.style.display=null,c.style.opacity=1,e.checked=!1):a.target.checked?tsfem_inpost.fadeOut(d,150,{cb:()=>{tsfem_inpost.fadeIn(c,250),a.target.checked=!0},promise:!1}):tsfem_inpost.fadeOut(c,150,{cb:()=>{tsfem_inpost.fadeIn(d,250),a.target.checked=!1},promise:!1})})};let G={};const H=()=>{const b=a=>(/\[([0-9]+)\]$/.exec(a)||"")[1],c=a=>{let c=i(a,"inflections"),d=c.querySelectorAll("input:checked"),e=[];d.forEach(a=>{e.push(b(a.id))}),i(a,"active_inflections").value=e.join(),K(a).clearCache("inflections"),R(a)},d=a=>{let c=i(a,"synonyms"),d=c.querySelectorAll("input:checked"),e=[];d.forEach(a=>{e.push(b(a.id))}),i(a,"active_synonyms").value=e.join(),K(a).clearCache("synonyms"),R(a)},e=a=>{let b=a.data.idPrefix,e=a.data.type,f=b+e;clearTimeout(G[f]),G[f]=setTimeout(()=>{"inflections"===e?c(b):"synonyms"===e?d(b):void 0},1500)},f=(b,c)=>{a(i(b,c)).find("input").off("change.tsfem-e-focus").on("change.tsfem-e-focus",{idPrefix:b,type:c},e)};a(window).off("tsfem-e-focus-updated-subject.tsfem-e-focus").on("tsfem-e-focus-updated-subject.tsfem-e-focus",(a,b)=>{if(!b||!b.idPrefix)return;const e=b.idPrefix,g=i(e,"inflection_data"),j=i(e,"synonym_data"),k=i(e,"definition_selection"),l=i(e,"inflections"),m=i(e,"synonyms"),n=l.querySelector(".tsfem-e-focus-subject-selection"),o=m.querySelector(".tsfem-e-focus-subject-selection"),p=wp.template("tsfem-e-focus-subject-item");let q=g.value&&JSON.parse(g.value),r=q&&q[0].inflections||{},s=j.value&&JSON.parse(j.value),t=s&&s[+k.value]&&s[+k.value].synonyms||{};n.style.opacity=0,o.style.opacity=0;let u=i(e,"active_inflections").value.split(","),v=i(e,"active_synonyms").value.split(","),w="",x=h(e,"inflection");for(let c in r)w+=p({id:h(x,c),value:r[c],checked:!+c||-1<u.indexOf(c+"")?"checked":"",disabled:+c?"":"disabled"});for(let c in n.innerHTML=w,w="",x=h(e,"synonym"),t)w+=p({id:h(x,c),value:t[c],checked:-1<v.indexOf(c+"")?"checked":""});o.innerHTML=w,r.length?(l.style.display=null,tsfem_inpost.fadeIn(n)):l.style.display="none",t.length?(m.style.display=null,tsfem_inpost.fadeIn(o)):m.style.display="none",c(e),d(e),f(e,"inflections"),f(e,"synonyms")})},I=b=>{a(window).trigger("tsfem-e-focus-updated-subject",[{idPrefix:b}])};let J={};const K=a=>{K.hasOwnProperty(a)||(J[a]={},J[a].inflections=null,J[a].synonyms=null);const b=()=>{let b,c,d=i(a,"active_inflections");if(d instanceof HTMLInputElement&&d.value){let e=i(a,"inflection_data").value;c=JSON.parse(e)[0].inflections,b=[],d.value.split(",").forEach(a=>{b.push(c[+a])})}if(!b){let c=i(a,"keyword").value;b=c&&[c]||!1}return b=b||!1,J[a].inflections=b,b},c=()=>{let b,c,d=i(a,"active_synonyms"),e=i(a,"definition_selection");if(d instanceof HTMLInputElement&&d.value){let f=i(a,"synonym_data").value;c=JSON.parse(f)[+e.value].synonyms,b=[],d.value.split(",").forEach(a=>{b.push(c[+a])})}return b=b||!1,J[a].synonyms=b,b},d=d=>{if(null!==J[a][d])return J[a][d];return"inflections"===d?b():"synonyms"===d?c():{inflections:b(),synonyms:c()}},e=b=>{b?delete J[a][b]:delete J[a]};return{get:a=>d(a),clearCache:a=>e(a)}},L=(a,b)=>{if("undefined"!=typeof f[a]){b=b||"unknown";for(let c=f[a].length;c--;)tsfem_inpost.setIconClass(document.getElementById(f[a][c]).querySelector(".tsfem-e-focus-assessment-rating"),b)}},M=(a,b)=>{let c=f;c&&c===Object(c)||(c=[]),c[b]&&c[b]===Object(c[b])||(c[b]=[]),a.id&&("undefined"==typeof e[b]?delete c[b][a.id]:0>c[b].indexOf(a.id)&&c[b].push(a.id)),f=c};let N={},O={};const P=b=>{const c=a=>{tsfem_inpost.promiseLoop(f[a],a=>{let b=g(a),c=i(b,"keyword"),d=c.value||"";if(!d.length)return;let e=document.getElementById(a),f=e.querySelector(".tsfem-e-focus-assessment-rating");tsfem_inpost.setIconClass(f,"loading"),setTimeout(()=>n(e),150)})},d=a=>{"undefined"==typeof f[a.data.type]||(clearTimeout(N[a.data.type]),!O[a.data.type]&&(setTimeout(()=>tsfem_inpost.setIconClass(document.querySelectorAll("[data-assessment-type=\""+a.data.type+"\"] .tsfem-e-focus-assessment-rating"),"unknown"),0),O[a.data.type]=!0),N[a.data.type]=setTimeout(()=>{c(a.data.type),O[a.data.type]=!1},1500))},h=b=>{let c=S(b).get("names");a(e[b].join(", ")).off(c).on(c,{type:b},d)};if(b)"undefined"!=typeof e[b]&&h(b);else for(let a in e)"undefined"!=typeof e[a]&&h(a)};let Q={};const R=b=>{b=b||0,clearTimeout(Q[b]),Q[b]=setTimeout(()=>{if(b){let a=i(b,"scores"),c=a&&a.querySelectorAll(".tsfem-e-focus-assessment-wrap[data-assess=\"1\"]");c instanceof NodeList&&c.length?tsfem_inpost.promiseLoop(c,a=>n(a),150):B(b).to("error")}else{for(var c in e)a(e[c].join(", ")).trigger(S(c).get("trigger"))}},1e3)},S=a=>{const b=["tsfem-e-focus.analysis-"+a,"input.tsfem-e-focus-"+a,"change.tsfem-e-focus-"+a];return{get:a=>"names"===a?b.join(" "):"trigger"===a?b[0]:b}},T=()=>{let b=a(document),c=document.getElementById("tsf-gutenberg-data-holder");if(!c)return;const d=a=>"tsfem-focus-gbc-".concat(a),e=a=>document.getElementById(d(a)),f=(a,c)=>{g(a),setTimeout(()=>{l(c),P(c)}),b.trigger("tsfem-focus-gutenberg-".concat(a,"-store-set"))},g=a=>{if(!e(a)){let b=document.createElement("div");b.id=d(a),b.style.display="none",c.appendChild(b)}},h=(a,b)=>{e(a).innerHTML=b},i=(b,c)=>{a("#"+d(b)).trigger(S(c).get("trigger"))};b.on("tsf-updated-gutenberg-title",(a,b)=>{h("title",b),i("title","pageTitle")}),f("title","pageTitle"),b.on("tsf-updated-gutenberg-link",(a,b)=>{h("link",b),i("link","pageUrl")}),f("link","pageUrl");const j=a=>{h("content",a),i("content","pageContent")};b.on("tsf-updated-gutenberg-content",(a,b)=>{let c=lodash.debounce(j,500),d=!1,e=wp.data.select("core/block-editor")||wp.data.select("core/editor");"function"==typeof e.isTyping&&(d=e.isTyping()),d?(L("pageContent","unknown"),c(b)):(c.cancel(),j(b))}),f("content","pageContent")},U=()=>{const c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;(()=>{if("undefined"==typeof b.focusElements.pageUrl)return;let d=document.getElementById("edit-slug-box");if(!d||!d instanceof HTMLElement)return;const e=()=>{let a=document.querySelectorAll(".tsfem-e-focus-assessment-wrap[data-assessment-type=\"url\"][data-assess=\"0\"]");a instanceof NodeList&&a.length&&(l("pageUrl"),P("pageUrl"),a.forEach(a=>A(a)))};new c(()=>{e(),P("pageUrl"),a("#sample-permalink").trigger(S("pageUrl").get("trigger"))}).observe(d,{childList:!0,subtree:!0})})(),(()=>{if("undefined"==typeof tinyMCE||"function"!=typeof tinyMCE.on)return;let b=!1;tinyMCE.on("addEditor",c=>{if(b)return;if("content"!==c.editor.id)return;b=!0,l("pageContent"),P("pageContent");let d={},e=tinyMCE.get("content"),f=!1,g=!1;e.on("Dirty",()=>{g||(L("pageContent","unknown"),g=!0)}),e.on("GetContent",()=>{clearTimeout(d.GetContent),!f&&e.isDirty()&&(L("pageContent","loading"),f=!0,g=!1),d.GetContent=setTimeout(()=>{e.isDirty()||a("#content").trigger(S("pageContent").get("trigger")),f=!1,g=!1},1e3)})})})()},V=()=>{b.isGutenbergPage?T():U()},W=()=>{let a=document.querySelectorAll(".tsfem-e-focus-collapse-wrap");for(let c=a.length;c--;){let d=g(a[c].id),e=i(d,"keyword");if(e.value.length){if(e.dataset.prev=e.value,tsfem_inpost.isPremium&&b.languageSupported){let a=i(d,"lexical_selector");a.dataset.prev=a.value,1<a.length?w(d).to("enabled"):r(d,"lexical"),+a.value&&(C(d).to("enabled"),v(d),I(d))}x(d)}}},X=()=>{if(V(),b.hasOwnProperty("focusElements")&&(k(b.focusElements,!0),l(),P()),0===Object.keys(e).length){let a=document.getElementById("tsfem-e-focus-analysis-wrap");if(a instanceof Element){let b=a.querySelector(".tsf-flex-setting-input");b instanceof Element&&(b.innerHTML=wp.template("tsfem-e-focus-nofocus")())}return}D(),E(),tsfem_inpost.isPremium&&b.languageSupported&&(F(),H()),W()};return a.extend({load:function(){a(".tsfem-e-focus-enable-if-js").removeProp("disabled"),a(".tsfem-e-focus-disable-if-js").prop("disabled","disabled"),a(".tsfem-e-focus-requires-javascript").removeClass("tsfem-e-focus-requires-javascript"),a(document.body).ready(X)}},{focusRegistry:d,activeFocusAreas:e,activeAssessments:f,updateFocusRegistry:k,updateActiveFocusAreas:l,resetAnalysisChangeListeners:P,triggerAllAnalysis:R,analysisChangeEvents:S,getSubIdPrefix:g,getSubElementById:i})}(jQuery),jQuery(window.tsfem_e_focus_inpost.load);
