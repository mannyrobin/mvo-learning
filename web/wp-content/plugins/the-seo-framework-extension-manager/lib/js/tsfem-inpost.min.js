'use strict';window.tsfem_inpost=function(a){const b=tsfem_inpostL10n.post_ID,d=tsfem_inpostL10n.nonce,e=tsfem_inpostL10n.rlt,f=tsfem_inpostL10n.isPremium,g=tsfem_inpostL10n.locale,h=tsfem_inpostL10n.debug,i=tsfem_inpostL10n.i18n;let n={},o={};const p=(I,J)=>{'busy'===J?o[I]=!0:delete o[I]},r=I=>p(I,'clear'),u=I=>I in n&&n[I]||void 0,v=I=>{n[I]&&(n[I].terminate(),r(I))},z=I=>{let J=I&&I.json||void 0,K=1===J;if(!K){let L=I;try{I=JSON.parse(I),K=!0}catch(M){K=!1,I=L}}return I};var A;const B=I=>{const J=(L,M)=>{let N=a(M),O=N.children('.tsfem-notice, .tsfem-notice-wrap .notice');1<O.length&&O.slice(0,O.length-1).each(function(){a(this).slideUp(200,function(){this.remove()})}),a(L).hide().appendTo(N).slideDown(200);let P=a('.tsfem-flex-settings-notification-area .tsfem-dismiss');const Q=R=>{a(R.target).closest('.tsfem-notice').slideUp(200,function(){this.remove()})};P.off('click',Q).on('click',Q)},K=(L,M)=>{let N=a.Deferred(),O=M?1:0,P='';return a.ajax({method:'POST',url:ajaxurl,datatype:'json',data:{action:'tsfem_inpost_get_dismissible_notice',post_ID:b,nonce:d,'tsfem-notice-key':L,'tsfem-notice-has-msg':O},timeout:7e3,async:!0}).done(Q=>{Q=z(Q),h&&console.log(Q);let R=Q&&Q.data||void 0,S=Q&&Q.type||void 0;if(!R||!S||'undefined'==typeof R.notice);else{let T='';O?(T=a(R.notice),e?T.find('p').first().prepend(M+' '):T.find('p').first().append(' '+M)):T=R.notice,P=T}}).fail((Q,R,S)=>{h&&(console.log(Q.responseText),console.log(S));let T=O?wp.template('tsfem-inpost-notice-error'):wp.template('tsfem-inpost-notice-5xx'),U=T({code:L,msg:M});P=U}).always(()=>{N.resolve(P)}),N.promise()};return{in:L=>{if(I){if(A)return void setTimeout(()=>{B(I).in(L)},500);A=!0;let M=I.type||'error',N=I.code||void 0,O=I.text||'';if(void 0===N)K(-1,O).always(P=>{J(P,L),A=!1});else if(''===O)K(N,'').always(P=>{J(P,L),A=!1});else{let P=wp.template('tsfem-inpost-notice-'+M);I=P({code:N,msg:O}),J(I,L),A=!1}}}}},C=(I,J,K)=>{h&&(console.log(I.responseText),console.log(K));let L='';switch(K){case'abort':case'timeout':L=i.TimeoutError;break;case'Bad Request':L=i.BadRequest;break;case'Internal Server Error':L=i.FatalError;break;case'parsererror':L=i.ParseError;break;default:L=i.UnknownError;}return L},D=(I,J)=>{if(I instanceof NodeList)return void I.forEach(L=>D(L,J));if(I&&!(!I instanceof Element)){['edit','loading','unknown','error','bad','warning','okay','good'].forEach(L=>{I.classList.remove('tsfem-e-inpost-icon-'+L),L===J&&I.classList.add('tsfem-e-inpost-icon-'+L)})}};var E={},F={};const G=(I,J,K,L)=>{if(I&&!(!I instanceof HTMLElement)){I.style.willChange='opacity';let M=!1,N=!1;'function'==typeof K?(M=K,N=!0):'object'==typeof K&&(M='undefined'==typeof K.cb&&!1||K.cb,N='undefined'==typeof K.promise&&!0||K.promise),J=J||250,L=void 0===L||L;let R,O=0,P=0,Q=10,S=I.dataset.tsfemFadeId||'_'+Math.random().toString(22).substr(2,10);I.dataset.tsfemFadeId=S,'undefined'!=typeof E[S]&&(clearInterval(E[S]),'undefined'!=typeof F[S]&&F[S].resolve()),N&&M&&(F[S]=a.Deferred(),(()=>{a.when(F[S]).done(()=>{delete F[S],M()})})(M)),L?(I.style.opacity=0,I.style.display=null,R=()=>{P=(O+=Q)/100,I.style.opacity=P,1<=P&&(clearInterval(E[S]),setTimeout(()=>I.style.opacity=1,0),I.style.display=null,N?'undefined'!=typeof F[S]&&F[S].resolve():M&&M(),'none'===I.style.display&&(I.style.display=null),I.style.willChange='auto',delete I.dataset.tsfemFadeId)}):(O=100*I.style.opacity,R=()=>{P=(O-=Q)/100,I.style.opacity=P,0>=P&&(clearInterval(E[S]),I.style.opacity=0,N?'undefined'!=typeof F[S]&&F[S].resolve():M&&M(),I.style.display='none',I.style.willChange='auto',delete I.dataset.tsfemFadeId)}),E[S]=setInterval(R,J*Q/100)}};return a.extend(!0,{load:function(){}},{postID:b,nonce:d,isPremium:f,locale:g,debug:h,i18n:i},{isActionableElement:I=>{return!(!I instanceof HTMLElement)&&(I instanceof HTMLInputElement||I instanceof HTMLSelectElement||I instanceof HTMLLabelElement||I instanceof HTMLButtonElement||I instanceof HTMLTextAreaElement)},escapeStr:(I,J)=>{return I.length?J?I.replace(/[&<>]/g,K=>{return{'&':'&amp;','<':'&lt;','>':'&gt;'}[K]}):I.replace(/[&<>"']/g,K=>{return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'}[K]}):''},promiseLoop:(I,J,K,L=2e3)=>{let M=a.Deferred(),N=I.length;if(!N)return M.resolve();const O=P=>{let Q,R,S;L&&(R=setTimeout(()=>{clearTimeout(Q),S=setTimeout(()=>{M.reject()},250)},L)),Q=setTimeout(()=>{a.when(J(I[P])).done(()=>{if(L&&(clearTimeout(R),S)){if(P<N)return;clearTimeout(S)}++P===N?M.resolve():(O(P),Q=null)}).fail(()=>{M.reject()})},K)};return O(0),M.promise()},occupyWorker:I=>p(I,'busy'),freeWorker:r,isWorkerBusy:I=>I in o,spawnWorker:(I,J)=>n[J]=new Worker(I),getWorker:u,stopWorker:v,despawnWorker:I=>{n[I]&&(v(I),delete n[I])},tellWorker:(I,J)=>{let K=a.Deferred();return setTimeout(()=>{let L=u(I);return L?void(L.onmessage=M=>{return'error'in M.data?(console.log(M.data.error),K.reject(M.data.error)):K.resolve(M.data)},L.onerror=M=>{return console.log(M),K.reject(M)},L.postMessage({id:I,data:J})):K.reject()}),K.promise()},doAjax:(I,J,K)=>{let L,M=K.noticeArea,N=K.premium||!1;return N&&!f?void I.reject():void(h&&console.log(J),a.ajax(J).done(O=>{I.notify(),O=z(O),h&&console.log(O);let P=O&&O.data||void 0,Q=O&&O.type||void 0;if(!P||!Q)return I.reject(),void(L={type:'error',code:-1,text:i.InvalidResponse});let R=P.results&&P.results.code||void 0,S=P.results&&P.results.notice||void 0,T=P.results&&P.results.type||void 0;R&&T&&(L={type:T,code:R,text:S}),'success'===Q&&'data'in P?I.resolve(P.data):I.reject(R)}).fail((O,P,Q)=>{I.reject(),h&&(console.log(O.responseText),console.log(Q)),L={type:'error',code:-1,text:C(O,P,Q)}}).always(()=>{I.notify(),L&&B(L).in(M)}))},convertJSONResponse:z,setFlexNotice:B,getAjaxError:C,setIconClass:D,fadeOut:(I,J,K)=>{G(I,J,K,!1)},fadeIn:G})}(jQuery),jQuery(window.tsfem_inpost.load);
