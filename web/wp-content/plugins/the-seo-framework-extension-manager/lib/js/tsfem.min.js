'use strict';window.tsfem={nonce:tsfemL10n.nonce,i18n:tsfemL10n.i18n,rtl:tsfemL10n.rtl,debug:tsfemL10n.debug,touchBuffer:!1,noticeBuffer:!1,navWarn:!1,setTouchBuffer:function(a){tsfem.touchBuffer=!0,setTimeout(()=>{tsfem.touchBuffer=!1},a)},setAjaxLoader:function(a){jQuery(a).toggleClass("tsfem-loading")},unsetAjaxLoader:function(a,b,c,d){let e="tsfem-success",f=2500;b?2===b&&(e="tsfem-unknown",f=7500):(e="tsfem-error",f=d?2e4:1e4),f=c?2*f:f,d?jQuery(a).removeClass("tsfem-loading").addClass(e).html(c).fadeOut(f):(c=jQuery("<span/>").html(c).text(),jQuery(a).removeClass("tsfem-loading").addClass(e).text(c).fadeOut(f))},resetAjaxLoader:function(a){jQuery(a).stop().empty().prop("class","tsfem-ajax").css({opacity:"1",display:"initial"}).prop("style","")},updateFeed:function(a){let b="tsfem-button-disabled",c=jQuery(a.target),d="#tsfem-feed-ajax",e=0;if(c.prop("disabled"))return;c.addClass("tsfem-button-disabled"),c.prop("disabled",!0),tsfem.resetAjaxLoader("#tsfem-feed-ajax"),tsfem.setAjaxLoader("#tsfem-feed-ajax");const f=()=>{c.removeClass(b),c.prop("disabled",!1),tsfem.updatedResponse(d,e,tsfem.i18n.UnknownError,0)};jQuery.ajax({method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfem_enable_feeds",nonce:tsfem.nonce},timeout:12e3,async:!0}).done(a=>{var b=Math.round,c=Math.pow;a=tsfem.convertJSONResponse(a),tsfem.debug&&console.log(a);let g=a&&a.data||void 0,h=a&&a.type||void 0;if("success"===h&&g){let a=g.content;switch(a.status){case"success":e=1,jQuery(".tsfem-trends-wrap").empty().css("opacity",0).append(a.wrap).animate({opacity:1},{queue:!0,duration:250});let f=400,g=a.data.length,h=0;for(let a=1;a<g-1;a++)h+=b(f/c(1+a/2/100,2));h-=2*f+f/2,jQuery.each(a.data,(a,d)=>{f=b(f/c(1+a/2/100,2)),setTimeout(()=>{jQuery(d).hide().appendTo(".tsfem-feed-wrap").slideDown(f)},f/2*a)}),setTimeout(()=>{tsfem.updatedResponse(d,e,"",0)},h);break;case"parse_error":case"unknown_error":default:jQuery(".tsfem-trends-wrap").empty().css("opacity",0).append(a.error_output).css("opacity",1).find(".tsfem-feed-wrap").css({opacity:0}).animate({opacity:1},{queue:!0,duration:2e3}),e="unknown_error"===a.status?2:0,setTimeout(()=>{tsfem.updatedResponse(d,e,tsfem.i18n.UnknownError,0)},1e3);}}else"unknown"===a.type?(e=2,f()):f()}).fail((a,e,f)=>{let g=tsfem.getAjaxError(a,e,f);c.removeClass(b),c.prop("disabled",!1),tsfem.updatedResponse(d,0,g,0)})},updateExtension:function(a){let b="tsfem-button-disabled",c=jQuery(a.target);if(c.prop("disabled")||c.hasClass("tsfem-button-disabled"))return;let d=jQuery(".tsfem-button-extension-activate, .tsfem-button-extension-deactivate").not(jQuery(".tsfem-button-disabled")),e=c.data("slug"),f=c.data("case"),g="#tsfem-extensions-ajax",h=0,i="",j=0,k="";d.map(()=>{jQuery(this).addClass(b),jQuery(this).prop("disabled",!0)}),tsfem.resetAjaxLoader(g),tsfem.setAjaxLoader(g),jQuery.ajax({method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfem_update_extension",nonce:tsfem.nonce,slug:e,case:f},timeout:1e4,async:!0}).done(a=>{a=tsfem.convertJSONResponse(a),tsfem.debug&&console.log(a);let b=a&&a.data||void 0,d=a&&a.type||void 0;if(!b||!d)k=tsfem.i18n.UnknownError;else{let a=b.results&&b.results.code||void 0,d=b.results&&b.results.success||void 0;if(k=b.results&&b.results.notice||void 0,"activate"===f)switch(a){case 10001:case 10002:case 10003:case 10004:case 10006:case 10007:case 10013:case 10014:h=0,j=a;break;case 10005:h=0;let d=b&&b.fatal_error||void 0;i=d,j=a;break;case 10008:case 10010:case 10012:h=1,c.removeClass("tsfem-button tsfem-button-extension-activate").addClass("tsfem-button-primary tsfem-button-primary-dark tsfem-button-extension-deactivate"),c.data("case","deactivate"),c.text(tsfem.i18n.Deactivate),jQuery("#"+e+"-extension-entry").removeClass("tsfem-extension-deactivated").addClass("tsfem-extension-activated"),tsfem.updateExtensionDescFooter(e,f);break;case 10009:h=2,j=a;break;default:h=0,k=tsfem.i18n.UnknownError;}else"deactivate"===f&&(11001===a?(h=1,c.removeClass("tsfem-button-primary tsfem-button-primary-dark tsfem-button-extension-deactivate").addClass("tsfem-button tsfem-button-extension-activate"),c.data("case","activate"),c.text(tsfem.i18n.Activate),jQuery("#"+e+"-extension-entry").removeClass("tsfem-extension-activated").addClass("tsfem-extension-deactivated"),tsfem.updateExtensionDescFooter(e,f)):11002===a||11003===a||11004===a?(h=0,j=a):(h=0,k=tsfem.i18n.UnknownError))}}).fail((a,b,c)=>{k=tsfem.getAjaxError(a,b,c),tsfem.setTopNotice(1071100),c&&tsfem.setTopNotice(-1,"jQ error: "+c)}).always(()=>{tsfem.updatedResponse(g,h,k,0),d.removeClass(b),d.prop("disabled",!1),c.focus(),j&&tsfem.setTopNotice(j,i)})},convertJSONResponse:function(a){let b=a&&a.json||void 0,c=1===b;if(!c){let b=a;try{a=JSON.parse(a),c=!0}catch(a){c=!1}c||(a=b)}return a},updatedResponse:function(a,b,c,d){switch(b){case 0:case 1:case 2:tsfem.unsetAjaxLoader(a,b,c,d);break;default:tsfem.resetAjaxLoader(a);}},getAjaxError:function(a,b,c){tsfem.debug&&(console.log(a.responseText),console.log(c));let d="";switch(c){case"abort":case"timeout":d=tsfem.i18n.TimeoutError;break;case"Bad Request":d=tsfem.i18n.BadRequest;break;case"Internal Server Error":d=tsfem.i18n.FatalError;break;case"parsererror":d=tsfem.i18n.ParseError;break;default:d=tsfem.i18n.UnknownError;}return d},unexpectedAjaxErrorNotice:function(a){a=tsfem.convertJSONResponse(a)||void 0;let b=a&&a.data||void 0;tsfem.debug&&console.log(a),b&&"results"in b&&"code"in b.results&&tsfem.setTopNotice(b.results.code,b.results.notice)},matosa:function(a){var b=null,c="";if(function a(d,e){if(e++,"object"==typeof d){let f,g;for(f in d)g=d[f];b=g,c+=1===e?f+a(g,e):"["+f+"]"+a(g,e)}else if(1===e)return b=null,c=!1;return c}(a,0),!1===c)return!1;let d={};return d[c]=b,d},updateExtensionDescFooter:function(a,b){jQuery.ajax({method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfem_update_extension_desc_footer",nonce:tsfem.nonce,slug:a,case:b},timeout:7e3,async:!0}).done(c=>{c=tsfem.convertJSONResponse(c),tsfem.debug&&console.log(c);let d=c&&c.data||void 0,e=c&&c.type||void 0;if(!d)return;let f=jQuery("#"+a+"-extension-entry .tsfem-extension-description-footer"),g="activate"===b?"up":"down";f.addClass("tsfem-flip-hide-"+g),setTimeout(()=>{f.empty().append(d),tsfTT.triggerReset()},250),setTimeout(()=>{f.addClass("tsfem-flip-show-"+g)},500),setTimeout(()=>{f.removeClass("tsfem-flip-hide-"+g+" tsfem-flip-show-"+g)},750)}).fail((a,b,c)=>{tsfem.debug&&(console.log(a.responseText),console.log(c))})},preventDefault:function(a){a.preventDefault(),a.stopPropagation()},engageSwitcher:function(){jQuery(window).off("click.tsfemResetSwitcher").on("click.tsfemResetSwitcher",a=>{let b=jQuery(".tsfem-switch-button-container > input[type=\"checkbox\"]:checked");if("undefined"!=typeof b&&0<b.length){let c=b.parents(".tsfem-switch-button-container-wrap");1>jQuery(a.target).closest(c).length&&(b.prop("checked",!1),jQuery(window).off("click.tsfemResetSwitcher"))}})},registerNavWarn:function(){tsfem.navWarn=!0},mustNavWarn:function(){return!!tsfem.navWarn},setDismissNoticeListener:function(){const a=a=>{jQuery(a.target).closest(".tsfem-notice").slideUp(200,function(){this.remove()})};jQuery(".tsfem-dismiss").off("click",a).on("click",a)},setTopNotice:function(a,b){if(tsfem.noticeBuffer)return void window.setTimeout(()=>{tsfem.setTopNotice(a,b)},500);tsfem.noticeBuffer=!0;let c=b?1:0;jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_get_dismissible_notice",nonce:tsfem.nonce,"tsfem-notice-key":a,"tsfem-notice-has-msg":c},timeout:7e3,async:!0}).done(a=>{a=tsfem.convertJSONResponse(a),tsfem.debug&&console.log(a);let d=a&&a.data||void 0,e=a&&a.type||void 0;if(!d||!e||"undefined"==typeof d.notice);else{let a="";c?(a=jQuery(d.notice),tsfem.rtl?a.find("p").first().prepend(b+" "):a.find("p").first().append(" "+b)):a=d.notice,tsfem.appendTopNotice(a)}}).fail((d,e,f)=>{tsfem.debug&&(console.log(d.responseText),console.log(f));let g=c?wp.template("tsfem-fbtopnotice-msg"):wp.template("tsfem-fbtopnotice"),h=g({code:a,msg:b});tsfem.appendTopNotice(h)}).always(()=>{tsfem.noticeBuffer=!1})},appendTopNotice:function(a){let b=jQuery(".tsfem-notice-wrap"),c=b.children(".tsfem-notice, .tsfem-notice-wrap .notice"),d={duration:200,queue:!1};b.css("willChange","contents"),1<c.length&&b.css("maxHeight",b.outerHeight()+"px"),1<c.length&&c.slice(0,c.length-1).each(function(){jQuery(this).slideUp(jQuery.extend(d,{complete:()=>this.remove()}))}),jQuery(a).hide().appendTo(b).slideDown(jQuery.extend(d,{complete:()=>b.css("maxHeight","")})),tsfem.setDismissNoticeListener()},dialog:function(a){let b=a.title||"",c=a.text||"",d=a.select||"",e=a.confirm||"",f=a.cancel||"",g={};if(g.mask=document.createElement("div"),g.mask.className="tsfem-modal-mask",g.maskNoScroll=document.createElement("div"),g.maskNoScroll.className="tsfem-modal-mask-noscroll",g.mask.appendChild(g.maskNoScroll),g.container=document.createElement("div"),g.container.className="tsfem-modal-container",g.dialogWrap=document.createElement("div"),g.dialogWrap.className="tsfem-modal-dialog-wrap",g.dialogWrap.style.marginLeft=document.getElementById("adminmenuwrap").offsetWidth+"px",g.dialogWrap.style.marginTop=document.getElementById("wpadminbar").offsetHeight+"px",g.dialog=document.createElement("div"),g.dialog.className="tsfem-modal-dialog",g.trap=document.createElement("div"),g.trap.className="tsfem-modal-trap",g.trap.tabIndex=0,g.bottomTrap=g.trap.cloneNode(!1),g.dialog.appendChild(g.trap),g.x=document.createElement("div"),g.x.className="tsfem-modal-dismiss",g.x.addEventListener("click",function(){window.dispatchEvent(new Event("tsfem_modalCancel"))}),g.dialog.appendChild(g.x),b&&(g.titleWrap=document.createElement("div"),g.titleWrap.className="tsfem-modal-title",g.titleWrapTitle=document.createElement("h4"),g.titleWrapTitle.innerHTML=b,g.titleWrap.appendChild(g.titleWrapTitle),g.dialog.appendChild(g.titleWrap)),g.inner=document.createElement("div"),g.inner.className="tsfem-modal-inner",c){if(g.textWrap=document.createElement("div"),g.textWrap.className="tsfem-modal-text",Array.isArray(c))for(let a in c)g.textWrapContent=document.createElement("p"),g.textWrapContent.innerHTML=c[a],g.textWrap.appendChild(g.textWrapContent);else g.textWrapContent=document.createElement("p"),g.textWrapContent.innerHTML=c,g.textWrap.appendChild(g.textWrapContent);g.inner.appendChild(g.textWrap)}let h=!1;if(d){h=!0,g.selectWrap=document.createElement("div"),g.selectWrap.className="tsfem-modal-select";let a={};a.wrap=document.createElement("div"),a.wrap.className="tsfem-modal-select-option",a.radio=document.createElement("input"),a.radio.setAttribute("type","radio"),a.radio.setAttribute("name","tsfem-modal-select-option-group"),a.radio.tabIndex=0,a.label=document.createElement("label"),function(){for(let b in d){let c=a.wrap.cloneNode(!0),e=a.radio.cloneNode(!1),f=a.label.cloneNode(!1);e.setAttribute("value",b),f.innerHTML=d[b],0==b&&(e.checked=!0);let h="tsfem-dialog-option-"+b;e.setAttribute("id",h),f.setAttribute("for",h),c.appendChild(e),c.appendChild(f),g.selectWrap.appendChild(c)}}(),g.inner.appendChild(g.selectWrap)}g.dialog.appendChild(g.inner),(e||f)&&(g.buttonWrap=document.createElement("div"),g.buttonWrap.className="tsfem-modal-buttons",e&&(g.confirmButton=document.createElement("button"),g.confirmButton.className="tsfem-modal-confirm tsfem-button-small",g.confirmButton.className+=h?" tsfem-button-primary tsfem-button-primary-bright":" tsfem-button",g.confirmButton.innerHTML=e,g.confirmButton.addEventListener("click",function(){let a;h&&(a={detail:{checked:document.querySelector(".tsfem-modal-select input:checked").value}}),window.dispatchEvent(new CustomEvent("tsfem_modalConfirm",a))}),g.buttonWrap.appendChild(g.confirmButton)),f&&(g.cancelButton=document.createElement("button"),g.cancelButton.className="tsfem-modal-cancel tsfem-button tsfem-button-small",g.cancelButton.innerHTML=f,g.cancelButton.addEventListener("click",()=>{window.dispatchEvent(new Event("tsfem_modalCancel"))}),g.buttonWrap.appendChild(g.cancelButton)),g.dialog.appendChild(g.buttonWrap)),g.dialog.appendChild(g.bottomTrap),g.dialogWrap.appendChild(g.dialog),g.container.appendChild(g.dialogWrap),document.body.appendChild(g.mask),document.body.appendChild(g.container);const i=()=>{g.trap.focus()};g.trap.addEventListener("focus",i),g.bottomTrap.addEventListener("focus",i),g.trap.focus(),tsfem.fadeIn(g.mask),tsfem.fadeIn(g.container);const j=a=>{a.preventDefault()};g.maskNoScroll.addEventListener("wheel",j),g.maskNoScroll.addEventListener("touchmove",j);const k=function(){g.dialogWrap.style.marginLeft=document.getElementById("adminmenuwrap").offsetWidth+"px",g.dialogWrap.style.marginTop=document.getElementById("wpadminbar").offsetHeight+"px"};window.addEventListener("resize",k);const l=()=>{g.maskNoScroll.removeEventListener("wheel",j),g.maskNoScroll.removeEventListener("touchmove",j),window.removeEventListener("tsfem_modalCancel",l),window.removeEventListener("tsfem_modalConfirm",l),window.removeEventListener("resize",k),tsfem.fadeOut(g.mask,250,()=>g.mask.remove()),tsfem.fadeOut(g.container,250,()=>g.container.remove())};window.addEventListener("tsfem_modalCancel",l),window.addEventListener("tsfem_modalConfirm",l)},fadeIn:function(a,b,c,d){if(void 0===a||!a instanceof HTMLElement)return;if(!a.style||!("opacity"in a.style))return;b=b||250,d=!(void 0!==d)||d;let e,f,g=0,h=0,i=3;d?f=()=>{h=(g+=i)/100,a.style.display=null,a.style.opacity=h,1<=h&&(clearInterval(e),a.style.opacity=1,"function"==typeof c&&c())}:(g=100,f=()=>{h=(g-=i)/100,a.style.opacity=h,0>=h&&(clearInterval(e),a.style.opacity=0,setTimeout(()=>{a.style.display="none"},0),"function"==typeof c&&c())}),e=setInterval(f,b/100)},fadeOut:function(a,b,c){tsfem.fadeIn(a,b,c,!1)},ready:function(a){a("#wpbody-content").find(".updated, .error, .notice-error, .notice-warning").appendTo(".tsfem-notice-wrap"),a("a#tsfem-enable-feeds").on("click",tsfem.updateFeed),a(".tsfem-button-extension-activate, .tsfem-button-extension-deactivate").on("click",tsfem.updateExtension),a(".tsfem-button-disabled").on("click",tsfem.preventDefault),a(".tsfem-switch-button-container-wrap").on("click","label",tsfem.engageSwitcher),a(document.body).ready(tsfem.setDismissNoticeListener)}},jQuery(tsfem.ready);
