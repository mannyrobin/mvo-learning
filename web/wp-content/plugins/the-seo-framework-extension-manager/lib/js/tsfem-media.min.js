'use strict';window.tsfemMedia={data:"undefined"!=typeof tsfemMediaData&&tsfemMediaData,cropper:{},escapeKey:function(a){return a?a.replace(/(?!\\)(?=[\[\]\/])/g,"\\"):a},openImageEditor:function(a){let b=jQuery(a.target);if(b.prop("disabled")||"undefined"==typeof wp.media)return a.preventDefault(),void a.stopPropagation();let c,d=b.data("input-url"),e=tsfemMedia.escapeKey(d),f=b.data("input-id"),g=tsfemMedia.escapeKey(d);a.preventDefault(),a.stopPropagation(),tsfemMedia.extendCropper(),c=wp.media({button:{text:tsfemMedia.data.imgFrameButton,close:!1},states:[new wp.media.controller.Library({title:tsfemMedia.data.imgFrameTitle,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20}),new tsfemMedia.cropper({imgSelectOptions:tsfemMedia.calculateImageSelectOptions})]});const h=function(){c.setState("cropper")},i=function(){jQuery("#"+e+"-select").text(tsfemMedia.data.imgChange),jQuery(document.getElementById(d)).prop("readonly",!0).css("opacity",0).animate({opacity:1},{queue:!0,duration:1e3});let a={};a.url=d,a.id=f,tsfemMedia.appendRemoveButton(b,a,!0),b.trigger("blur"),tsfem.registerNavWarn(),c.close()};c.on("select",h),c.on("cropped",function(a){let b=a.url,c=a.id,e=document.getElementById(d),g=document.getElementById(f);e.value=b,g.value=c,jQuery(e).trigger("change"),jQuery(g).trigger("change")}),c.on("skippedcrop",function(a){let b=a.get("url"),c=a.get("id"),e=document.getElementById(d),g=document.getElementById(f);e.value=b,g.value=c,jQuery(e).trigger("change"),jQuery(g).trigger("change")}),c.on("skippedcrop cropped",i),c.open()},appendRemoveButton:function(a,b,c){if(a&&b.url){let d=tsfemMedia.escapeKey(b.url);jQuery("#"+d+"-remove").length||(a.after("<button type=button id=\""+b.url+"-remove\" class=\"tsfem-remove-image-button tsfem-button-primary tsfem-button-small\" data-input-url=\""+b.url+"\" data-input-id=\""+b.id+"\" title=\""+tsfemMedia.data.imgRemoveTitle+"\">"+tsfemMedia.data.imgRemove+"</button>"),c&&jQuery("#"+d+"-remove").css("opacity",0).animate({opacity:1},{queue:!0,duration:1e3}))}tsfemMedia.resetImageEditorRemovalActions()},removeEditorImage:function(a){let b=jQuery(a.target),c=b.data("input-url"),d=b.data("input-id"),e=document.getElementById(c+"-select"),f=document.getElementById(c+"-remove");if(!jQuery(e).prop("disabled")){jQuery(e).addClass("tsfem-button-disabled").prop("disabled",!0).text(tsfemMedia.data.imgSelect),jQuery(f).addClass("tsfem-button-disabled").prop("disabled",!0).fadeOut(500,function(){jQuery(this).remove(),jQuery(e).removeClass("tsfem-button-disabled").removeProp("disabled")});let a=jQuery(document.getElementById(c));a.val("").trigger("change"),a.data("readonly")||a.removeProp("readonly"),a.css("opacity",0).animate({opacity:1},{queue:!0,duration:500}),document.getElementById(d).value="",tsfem.registerNavWarn()}},extendCropper:function(){if("undefined"==typeof tsfemMedia.cropper.control){var a;let b=wp.media.controller;return a=b.Cropper.extend({doCrop:function(a){var b=Math.round,c=a.get("cropDetails"),d=tsfemMedia.cropper.control;if(d.params.flex_width&&d.params.flex_height)if(c.width===c.height)c.width>d.params.flex_width&&(c.dst_width=c.dst_height=d.params.flex_width);else if(c.width>d.params.flex_width||c.height>d.params.flex_height)if(c.width>c.height){var e=c.width/d.params.flex_width;c.dst_width=d.params.flex_width,c.dst_height=b(c.height/e)}else{var e=c.height/d.params.flex_height;c.dst_height=d.params.flex_height,c.dst_width=b(c.width/e)}return"undefined"==typeof c.dst_width&&(c.dst_width=0,c.dst_height=0),wp.ajax.post("tsfem_crop_image",{nonce:tsfemMedia.data.nonce,id:a.get("id"),context:"tsfem-image",cropDetails:c})}}),a.prototype.control={},a.control={params:{flex_width:4096,flex_height:4096,width:1920,height:1080}},void(tsfemMedia.cropper=a)}},calculateImageSelectOptions:function(a,b){let c=tsfemMedia.cropper.control;var d=!!parseInt(c.params.flex_width,10),e=!!parseInt(c.params.flex_height,10),f=parseInt(c.params.width,10),g=parseInt(c.params.height,10);let h,i,j,k=a.get("width"),l=a.get("height"),m=f/g,n=f,o=g;return b.set("control",c.params),b.set("canSkipCrop",!tsfemMedia.mustBeCropped(c.params.flex_width,c.params.flex_height,k,l)),k/l>m?(g=l,f=g*m):(f=k,g=f/m),h=(k-f)/2,i=(l-g)/2,j={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:k,imageHeight:l,minWidth:n>f?f:n,minHeight:o>g?g:o,x1:h,y1:i,x2:f+h,y2:g+i},!1==e&&!1==d&&(j.aspectRatio=f+":"+g),!0==e&&(j.minHeight=200,j.maxWidth=k),!0==d&&(j.minWidth=200,j.maxHeight=l),j},mustBeCropped:function(a,b,c,d){return!(c<=a&&d<=b)},checkImageEditorInput:function(){let a=jQuery(".tsfem-set-image-button");if(a.length){let b,c,d,e={};jQuery.each(a,function(a,f){if(d=jQuery(f),b=document.getElementById(d.data("input-url")),c=document.getElementById(d.data("input-id")),c.length&&0<c.value&&(e.url=d.data("input-url"),e.id=d.data("input-id"),jQuery(b).prop("readonly",!0),tsfemMedia.appendRemoveButton(d,e,!1)),b.value){let a=tsfemMedia.escapeKey(d.data("input-id"));jQuery("#"+a+"-select").text(tsfemMedia.data.imgChange)}})}},resetImageEditorRemovalActions:function(){jQuery(".tsfem-remove-image-button").off("click",tsfemMedia.removeEditorImage).on("click",tsfemMedia.removeEditorImage)},setupImageEditorActions:function(){const a=function(){jQuery(".tsfem-set-image-button").off("click",tsfemMedia.openImageEditor).on("click",tsfemMedia.openImageEditor),jQuery(".tsfem-remove-image-button").off("click",tsfemMedia.removeEditorImage).on("click",tsfemMedia.removeEditorImage)};a(),jQuery(window).on("tsfemForm.iterationComplete tsfemForm.deiterationComplete",a)},ready:function(a){a(document.body).ready(tsfemMedia.setupImageEditorActions),a(document.body).ready(tsfemMedia.checkImageEditorInput)}},jQuery(tsfemMedia.ready);
